<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>XMonad/Actions/Launcher.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{- |
<a name="line-2"></a>Module      :  XMonad.Actions.Launcher
<a name="line-3"></a>Copyright   :  (C) 2012 Carlos LÃ³pez-Camey
<a name="line-4"></a>License     :  None; public domain
<a name="line-5"></a>
<a name="line-6"></a>Maintainer  :  &lt;c.lopez@kmels.net&gt;
<a name="line-7"></a>Stability   :  unstable
<a name="line-8"></a>
<a name="line-9"></a>A set of prompts for XMonad
<a name="line-10"></a>-}</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Actions</span><span class='hs-varop'>.</span><span class='hs-conid'>Launcher</span><span class='hs-layout'>(</span>
<a name="line-13"></a>  <span class='hs-comment'>-- * Description and use</span>
<a name="line-14"></a>  <span class='hs-comment'>-- $description</span>
<a name="line-15"></a>  <span class='hs-varid'>defaultLauncherModes</span>
<a name="line-16"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>ExtensionActions</span>
<a name="line-17"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>LauncherConfig</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-18"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>launcherPrompt</span>
<a name="line-19"></a><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>       <span class='hs-layout'>(</span><span class='hs-varid'>find</span><span class='hs-layout'>,</span> <span class='hs-varid'>findIndex</span><span class='hs-layout'>,</span> <span class='hs-varid'>isPrefixOf</span><span class='hs-layout'>,</span> <span class='hs-varid'>tails</span><span class='hs-layout'>)</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span>        <span class='hs-keyword'>as</span> <span class='hs-conid'>M</span>
<a name="line-23"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span>      <span class='hs-layout'>(</span><span class='hs-varid'>isJust</span><span class='hs-layout'>)</span>
<a name="line-24"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>XMonad</span>          <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>config</span><span class='hs-layout'>)</span>
<a name="line-25"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Prompt</span>
<a name="line-26"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Util</span><span class='hs-varop'>.</span><span class='hs-conid'>Run</span>
<a name="line-27"></a>
<a name="line-28"></a><span class='hs-comment'>{- $description
<a name="line-29"></a>    This module exemplifies usage of `XMonad.Prompt.mkXPromptWithModes`. It includes two modes:
<a name="line-30"></a>
<a name="line-31"></a>       * Hoogle mode: Search for functions using hoogle, choosing a function leads you to documentation in Haddock.
<a name="line-32"></a>
<a name="line-33"></a>       * Calc: Uses the program calc to do calculations.
<a name="line-34"></a>
<a name="line-35"></a>    To test it, modify your local .xmonad:
<a name="line-36"></a>
<a name="line-37"></a>    &gt; import XMonad.Prompt(defaultXPConfig)
<a name="line-38"></a>    &gt; import XMonad.Actions.Launcher
<a name="line-39"></a>
<a name="line-40"></a>    &gt; ((modm .|. controlMask, xK_l), launcherPrompt defaultXPConfig $ defaultLauncherModes launcherConfig)
<a name="line-41"></a>
<a name="line-42"></a>    A LauncherConfig contains settings for the default modes, modify them accordingly.
<a name="line-43"></a>
<a name="line-44"></a>    &gt; launcherConfig = LauncherConfig { pathToHoogle = "/home/YOU/.cabal/bin/hoogle" , browser = "firefox"}
<a name="line-45"></a>
<a name="line-46"></a>Restart xmonad. Press Ctrl + Your_Modkey + L and the first prompt should pop up.
<a name="line-47"></a>
<a name="line-48"></a> If you used 'defaultXPConfig', you can change mode with 'xK_grave'. If you are using your own 'XPConfig', define the value for 'changeModeKey'.
<a name="line-49"></a> -}</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="HoogleMode"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HoogleMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HMode</span> <span class='hs-conid'>FilePath</span> <span class='hs-conid'>String</span> <span class='hs-comment'>--path to hoogle and browser</span>
<a name="line-52"></a><a name="CalculatorMode"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CalculatorMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CalcMode</span>
<a name="line-53"></a>
<a name="line-54"></a><a name="LauncherConfig"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LauncherConfig</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LauncherConfig</span> <span class='hs-layout'>{</span>
<a name="line-55"></a>  <span class='hs-varid'>browser</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>
<a name="line-56"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>pathToHoogle</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>
<a name="line-57"></a><span class='hs-layout'>}</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="ExtensionActions"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ExtensionActions</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span><span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-60"></a>
<a name="line-61"></a><a name="instance%20XPrompt%20CalculatorMode"></a><span class='hs-comment'>-- | Uses the command `calc` to compute arithmetic expressions</span>
<a name="line-62"></a><a name="instance%20XPrompt%20CalculatorMode"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>XPrompt</span> <span class='hs-conid'>CalculatorMode</span> <span class='hs-keyword'>where</span>
<a name="line-63"></a>  <span class='hs-varid'>showXPrompt</span> <span class='hs-conid'>CalcMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"calc %s&gt; "</span>
<a name="line-64"></a>  <span class='hs-varid'>commandToComplete</span> <span class='hs-conid'>CalcMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-comment'>--send the whole string to `calc`</span>
<a name="line-65"></a>  <span class='hs-varid'>completionFunction</span> <span class='hs-conid'>CalcMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>s</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>return</span> <span class='hs-conid'>[]</span> <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<a name="line-66"></a>    <span class='hs-varid'>fmap</span> <span class='hs-varid'>lines</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runProcessWithInput</span> <span class='hs-str'>"calc"</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span> <span class='hs-str'>""</span>
<a name="line-67"></a>  <span class='hs-varid'>modeAction</span> <span class='hs-conid'>CalcMode</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span> <span class='hs-comment'>-- do nothing; this might copy the result to the clipboard</span>
<a name="line-68"></a>
<a name="line-69"></a><a name="instance%20XPrompt%20HoogleMode"></a><span class='hs-comment'>-- | Uses the program `hoogle` to search for functions</span>
<a name="line-70"></a><a name="instance%20XPrompt%20HoogleMode"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>XPrompt</span> <span class='hs-conid'>HoogleMode</span> <span class='hs-keyword'>where</span>
<a name="line-71"></a>  <span class='hs-varid'>showXPrompt</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"hoogle %s&gt; "</span>
<a name="line-72"></a>  <span class='hs-varid'>commandToComplete</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-73"></a>  <span class='hs-varid'>completionFunction</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMode</span> <span class='hs-varid'>pathToHoogleBin'</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>completionFunctionWith</span> <span class='hs-varid'>pathToHoogleBin'</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"--count"</span><span class='hs-layout'>,</span><span class='hs-str'>"8"</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span>
<a name="line-74"></a>  <span class='hs-comment'>-- This action calls hoogle again to find the URL corresponding to the autocompleted item</span>
<a name="line-75"></a>  <span class='hs-varid'>modeAction</span> <span class='hs-layout'>(</span><span class='hs-conid'>HMode</span> <span class='hs-varid'>pathToHoogleBin''</span> <span class='hs-varid'>browser'</span><span class='hs-layout'>)</span> <span class='hs-varid'>query</span> <span class='hs-varid'>result</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-76"></a>    <span class='hs-varid'>completionsWithLink</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftIO</span> <span class='hs-varop'>$</span> <span class='hs-varid'>completionFunctionWith</span> <span class='hs-varid'>pathToHoogleBin''</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"--count"</span><span class='hs-layout'>,</span><span class='hs-str'>"5"</span><span class='hs-layout'>,</span><span class='hs-str'>"--link"</span><span class='hs-layout'>,</span><span class='hs-varid'>query</span><span class='hs-keyglyph'>]</span>
<a name="line-77"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>link</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-78"></a>          <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>find</span> <span class='hs-layout'>(</span><span class='hs-varid'>isJust</span> <span class='hs-varop'>.</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>complStr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>findSeqIndex</span> <span class='hs-varid'>complStr</span> <span class='hs-varid'>result</span><span class='hs-layout'>)</span> <span class='hs-varid'>completionsWithLink</span>
<a name="line-79"></a>          <span class='hs-varid'>i</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>findSeqIndex</span> <span class='hs-varid'>s</span> <span class='hs-str'>"http://"</span>
<a name="line-80"></a>          <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>drop</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s</span>
<a name="line-81"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>link</span> <span class='hs-keyword'>of</span>
<a name="line-82"></a>       <span class='hs-conid'>Just</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>spawn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>browser'</span> <span class='hs-varop'>++</span> <span class='hs-str'>" "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>l</span>
<a name="line-83"></a>       <span class='hs-keyword'>_</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-84"></a>    <span class='hs-keyword'>where</span>
<a name="line-85"></a>      <span class='hs-comment'>-- | Receives a sublist and a list. It returns the index where the sublist appears in the list.</span>
<a name="line-86"></a>      <span class='hs-varid'>findSeqIndex</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-87"></a>      <span class='hs-varid'>findSeqIndex</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>xss</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>findIndex</span> <span class='hs-layout'>(</span><span class='hs-varid'>isPrefixOf</span> <span class='hs-varid'>xss</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>tails</span> <span class='hs-varid'>xs</span>
<a name="line-88"></a>
<a name="line-89"></a><a name="completionFunctionWith"></a><span class='hs-comment'>-- | Creates an autocompletion function for a programm given the program's name and a list of args to send to the command.</span>
<a name="line-90"></a><span class='hs-definition'>completionFunctionWith</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span>
<a name="line-91"></a><span class='hs-definition'>completionFunctionWith</span> <span class='hs-varid'>cmd</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>lines</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runProcessWithInput</span> <span class='hs-varid'>cmd</span> <span class='hs-varid'>args</span> <span class='hs-str'>""</span>
<a name="line-92"></a>
<a name="line-93"></a><a name="launcherPrompt"></a><span class='hs-comment'>-- | Creates a prompt with the given modes</span>
<a name="line-94"></a><span class='hs-definition'>launcherPrompt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XPConfig</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>XPMode</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span><span class='hs-conid'>()</span>
<a name="line-95"></a><span class='hs-definition'>launcherPrompt</span> <span class='hs-varid'>config</span> <span class='hs-varid'>modes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkXPromptWithModes</span> <span class='hs-varid'>modes</span> <span class='hs-varid'>config</span>
<a name="line-96"></a>
<a name="line-97"></a><a name="defaultLauncherModes"></a><span class='hs-comment'>-- | Create a list of modes based on :</span>
<a name="line-98"></a><span class='hs-comment'>-- a list of extensions mapped to actions</span>
<a name="line-99"></a><span class='hs-comment'>-- the path to hoogle</span>
<a name="line-100"></a><span class='hs-definition'>defaultLauncherModes</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LauncherConfig</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>XPMode</span><span class='hs-keyglyph'>]</span>
<a name="line-101"></a><span class='hs-definition'>defaultLauncherModes</span> <span class='hs-varid'>cnf</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span>
<a name="line-102"></a>  <span class='hs-varid'>ph</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pathToHoogle</span> <span class='hs-varid'>cnf</span>
<a name="line-103"></a>  <span class='hs-keyword'>in</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>hoogleMode</span> <span class='hs-varid'>ph</span> <span class='hs-varop'>$</span> <span class='hs-varid'>browser</span> <span class='hs-varid'>cnf</span>
<a name="line-104"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>calcMode</span><span class='hs-keyglyph'>]</span>
<a name="line-105"></a>
<a name="line-106"></a><a name="hoogleMode"></a><span class='hs-definition'>hoogleMode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>XPMode</span>
<a name="line-107"></a><span class='hs-definition'>hoogleMode</span> <span class='hs-varid'>pathToHoogleBin</span> <span class='hs-varid'>browser'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XPT</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HMode</span> <span class='hs-varid'>pathToHoogleBin</span> <span class='hs-varid'>browser'</span>
<a name="line-108"></a><a name="calcMode"></a><span class='hs-definition'>calcMode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XPMode</span>
<a name="line-109"></a><span class='hs-definition'>calcMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XPT</span> <span class='hs-conid'>CalcMode</span>
<a name="line-110"></a>
<a name="line-111"></a><span class='hs-comment'>{-
<a name="line-112"></a>
<a name="line-113"></a>  -- ideas for XMonad.Prompt running on mode XPMultipleModes
<a name="line-114"></a>     * Switch to mode by name of the prompt, 1. ':' at an empty(?) buffer, 2. autocomplete name in buffer should happen, 3. switch to mode with enter (cancel switch with C-g)
<a name="line-115"></a>
<a name="line-116"></a>     * Support for actions of type String -&gt; X a
<a name="line-117"></a>
<a name="line-118"></a>  -- ideas for this module
<a name="line-119"></a>
<a name="line-120"></a>     * Hoogle mode: add a setting in the action to either go to documentation or to the source code (needs hoogle change?)
<a name="line-121"></a>
<a name="line-122"></a>     * Hoogle mode: add setting to query hoogle at haskell.org instead (with &amp;mode=json)
<a name="line-123"></a>-}</span>
</pre></body>
</html>
