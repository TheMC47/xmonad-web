<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>XMonad/Layout/LayoutModifier.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable, FlexibleInstances, MultiParamTypeClasses, PatternGuards #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-4"></a><span class='hs-comment'>-- |</span>
<a name="line-5"></a><span class='hs-comment'>-- Module       : XMonad.Layout.LayoutModifier</span>
<a name="line-6"></a><span class='hs-comment'>-- Copyright    : (c) David Roundy &lt;droundy@darcs.net&gt;</span>
<a name="line-7"></a><span class='hs-comment'>-- License      : BSD</span>
<a name="line-8"></a><span class='hs-comment'>--</span>
<a name="line-9"></a><span class='hs-comment'>-- Maintainer   : none</span>
<a name="line-10"></a><span class='hs-comment'>-- Stability    : unstable</span>
<a name="line-11"></a><span class='hs-comment'>-- Portability  : portable</span>
<a name="line-12"></a><span class='hs-comment'>--</span>
<a name="line-13"></a><span class='hs-comment'>-- A module for writing easy layout modifiers, which do not define a</span>
<a name="line-14"></a><span class='hs-comment'>-- layout in and of themselves, but modify the behavior of or add new</span>
<a name="line-15"></a><span class='hs-comment'>-- functionality to other layouts.  If you ever find yourself writing</span>
<a name="line-16"></a><span class='hs-comment'>-- a layout which takes another layout as a parameter, chances are you</span>
<a name="line-17"></a><span class='hs-comment'>-- should be writing a LayoutModifier instead!</span>
<a name="line-18"></a><span class='hs-comment'>--</span>
<a name="line-19"></a><span class='hs-comment'>-- In case it is not clear, this module is not intended to help you</span>
<a name="line-20"></a><span class='hs-comment'>-- configure xmonad, it is to help you write other extension modules.</span>
<a name="line-21"></a><span class='hs-comment'>-- So get hacking!</span>
<a name="line-22"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-23"></a>
<a name="line-24"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Layout</span><span class='hs-varop'>.</span><span class='hs-conid'>LayoutModifier</span> <span class='hs-layout'>(</span>
<a name="line-25"></a>    <span class='hs-comment'>-- * Usage</span>
<a name="line-26"></a>    <span class='hs-comment'>-- $usage</span>
<a name="line-27"></a>
<a name="line-28"></a>    <span class='hs-comment'>-- * The 'LayoutModifier' class</span>
<a name="line-29"></a>    <span class='hs-conid'>LayoutModifier</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ModifiedLayout</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-30"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-31"></a>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span>
<a name="line-33"></a>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>XMonad</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>StackSet</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Stack</span><span class='hs-layout'>,</span> <span class='hs-conid'>Workspace</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-36"></a>
<a name="line-37"></a><span class='hs-comment'>-- $usage</span>
<a name="line-38"></a><span class='hs-comment'>--</span>
<a name="line-39"></a><span class='hs-comment'>-- The 'LayoutModifier' class is provided to help extension developers</span>
<a name="line-40"></a><span class='hs-comment'>-- write easy layout modifiers.  End users won't find much of interest</span>
<a name="line-41"></a><span class='hs-comment'>-- here. =)</span>
<a name="line-42"></a><span class='hs-comment'>--</span>
<a name="line-43"></a><span class='hs-comment'>-- To write a layout modifier using the 'LayoutModifier' class, define</span>
<a name="line-44"></a><span class='hs-comment'>-- a data type to represent the layout modification (storing any</span>
<a name="line-45"></a><span class='hs-comment'>-- necessary state), define an instance of 'LayoutModifier', and</span>
<a name="line-46"></a><span class='hs-comment'>-- export an appropriate function for applying the modifier.  For example:</span>
<a name="line-47"></a><span class='hs-comment'>--</span>
<a name="line-48"></a><span class='hs-comment'>-- &gt; data MyModifier a = MyModifier MyState</span>
<a name="line-49"></a><span class='hs-comment'>-- &gt;   deriving (Show, Read)</span>
<a name="line-50"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-51"></a><span class='hs-comment'>-- &gt; instance LayoutModifier MyModifier a where</span>
<a name="line-52"></a><span class='hs-comment'>-- &gt;   -- override whatever methods from LayoutModifier you like</span>
<a name="line-53"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-54"></a><span class='hs-comment'>-- &gt; modify :: l a -&gt; ModifiedLayout MyModifier l a</span>
<a name="line-55"></a><span class='hs-comment'>-- &gt; modify = ModifiedLayout (MyModifier initialState)</span>
<a name="line-56"></a><span class='hs-comment'>--</span>
<a name="line-57"></a><span class='hs-comment'>-- When defining an instance of 'LayoutModifier', you are free to</span>
<a name="line-58"></a><span class='hs-comment'>-- override as many or as few of the methods as you see fit.  See the</span>
<a name="line-59"></a><span class='hs-comment'>-- documentation below for specific information about the effect of</span>
<a name="line-60"></a><span class='hs-comment'>-- overriding each method.  Every method has a default implementation;</span>
<a name="line-61"></a><span class='hs-comment'>-- an instance of 'LayoutModifier' which did not provide a non-default</span>
<a name="line-62"></a><span class='hs-comment'>-- implementation of any of the methods would simply act as the</span>
<a name="line-63"></a><span class='hs-comment'>-- identity on any layouts to which it is applied.</span>
<a name="line-64"></a><span class='hs-comment'>--</span>
<a name="line-65"></a><span class='hs-comment'>-- For more specific usage examples, see</span>
<a name="line-66"></a><span class='hs-comment'>--</span>
<a name="line-67"></a><span class='hs-comment'>-- * "XMonad.Layout.WorkspaceDir"</span>
<a name="line-68"></a><span class='hs-comment'>--</span>
<a name="line-69"></a><span class='hs-comment'>-- * "XMonad.Layout.Magnifier"</span>
<a name="line-70"></a><span class='hs-comment'>--</span>
<a name="line-71"></a><span class='hs-comment'>-- * "XMonad.Layout.NoBorders"</span>
<a name="line-72"></a><span class='hs-comment'>--</span>
<a name="line-73"></a><span class='hs-comment'>-- * "XMonad.Layout.Reflect"</span>
<a name="line-74"></a><span class='hs-comment'>--</span>
<a name="line-75"></a><span class='hs-comment'>-- * "XMonad.Layout.Named"</span>
<a name="line-76"></a><span class='hs-comment'>--</span>
<a name="line-77"></a><span class='hs-comment'>-- * "XMonad.Layout.WindowNavigation"</span>
<a name="line-78"></a><span class='hs-comment'>--</span>
<a name="line-79"></a><span class='hs-comment'>-- and several others.  You probably want to start by looking at some</span>
<a name="line-80"></a><span class='hs-comment'>-- of the above examples; the documentation below is detailed but</span>
<a name="line-81"></a><span class='hs-comment'>-- possibly confusing, and in many cases the creation of a</span>
<a name="line-82"></a><span class='hs-comment'>-- 'LayoutModifier' is actually quite simple.</span>
<a name="line-83"></a><span class='hs-comment'>--</span>
<a name="line-84"></a><span class='hs-comment'>-- /Important note/: because of the way the 'LayoutModifier' class is</span>
<a name="line-85"></a><span class='hs-comment'>-- intended to be used, by overriding any of its methods and keeping</span>
<a name="line-86"></a><span class='hs-comment'>-- default implementations for all the others, 'LayoutModifier'</span>
<a name="line-87"></a><span class='hs-comment'>-- methods should never be called explicitly.  It is likely that such</span>
<a name="line-88"></a><span class='hs-comment'>-- explicit calls will not have the intended effect.  Rather, the</span>
<a name="line-89"></a><span class='hs-comment'>-- 'LayoutModifier' methods should only be called indirectly through</span>
<a name="line-90"></a><span class='hs-comment'>-- the 'LayoutClass' instance for 'ModifiedLayout', since it is this</span>
<a name="line-91"></a><span class='hs-comment'>-- instance that defines the semantics of overriding the various</span>
<a name="line-92"></a><span class='hs-comment'>-- 'LayoutModifier' methods.</span>
<a name="line-93"></a>
<a name="line-94"></a><a name="LayoutModifier"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LayoutModifier</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-95"></a>
<a name="line-96"></a>    <span class='hs-comment'>-- | 'modifyLayout' allows you to intercept a call to 'runLayout'</span>
<a name="line-97"></a>    <span class='hs-comment'>--   /before/ it is called on the underlying layout, in order to</span>
<a name="line-98"></a>    <span class='hs-comment'>--   perform some effect in the X monad, and\/or modify some of</span>
<a name="line-99"></a>    <span class='hs-comment'>--   the parameters before passing them on to the 'runLayout'</span>
<a name="line-100"></a>    <span class='hs-comment'>--   method of the underlying layout.</span>
<a name="line-101"></a>    <span class='hs-comment'>--</span>
<a name="line-102"></a>    <span class='hs-comment'>--   The default implementation of 'modifyLayout' simply calls</span>
<a name="line-103"></a>    <span class='hs-comment'>--   'runLayout' on the underlying layout.</span>
<a name="line-104"></a>    <span class='hs-varid'>modifyLayout</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>LayoutClass</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-105"></a>                    <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>                             <span class='hs-comment'>-- ^ the layout modifier</span>
<a name="line-106"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Workspace</span> <span class='hs-conid'>WorkspaceId</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>   <span class='hs-comment'>-- ^ current workspace</span>
<a name="line-107"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span>                       <span class='hs-comment'>-- ^ screen rectangle</span>
<a name="line-108"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-109"></a>    <span class='hs-varid'>modifyLayout</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>w</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runLayout</span> <span class='hs-varid'>w</span> <span class='hs-varid'>r</span>
<a name="line-110"></a>
<a name="line-111"></a>    <span class='hs-comment'>-- | Similar to 'modifyLayout', but this function also allows you</span>
<a name="line-112"></a>    <span class='hs-comment'>-- update the state of your layout modifier(the second value in the</span>
<a name="line-113"></a>    <span class='hs-comment'>-- outer tuple).</span>
<a name="line-114"></a>    <span class='hs-comment'>--</span>
<a name="line-115"></a>    <span class='hs-comment'>-- If both 'modifyLayoutWithUpdate' and 'redoLayout' return a</span>
<a name="line-116"></a>    <span class='hs-comment'>-- modified state of the layout modifier, 'redoLayout' takes</span>
<a name="line-117"></a>    <span class='hs-comment'>-- precedence. If this function returns a modified state, this</span>
<a name="line-118"></a>    <span class='hs-comment'>-- state will internally be used in the subsequent call to</span>
<a name="line-119"></a>    <span class='hs-comment'>-- 'redoLayout' as well.</span>
<a name="line-120"></a>    <span class='hs-varid'>modifyLayoutWithUpdate</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>LayoutClass</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-121"></a>                              <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-122"></a>                           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Workspace</span> <span class='hs-conid'>WorkspaceId</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-123"></a>                           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span>
<a name="line-124"></a>                           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-125"></a>    <span class='hs-varid'>modifyLayoutWithUpdate</span> <span class='hs-varid'>m</span> <span class='hs-varid'>w</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>(,)</span> <span class='hs-conid'>Nothing</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>modifyLayout</span> <span class='hs-varid'>m</span> <span class='hs-varid'>w</span> <span class='hs-varid'>r</span>
<a name="line-126"></a>
<a name="line-127"></a>    <span class='hs-comment'>-- | 'handleMess' allows you to spy on messages to the underlying</span>
<a name="line-128"></a>    <span class='hs-comment'>--   layout, in order to have an effect in the X monad, or alter</span>
<a name="line-129"></a>    <span class='hs-comment'>--   the layout modifier state in some way (by returning @Just</span>
<a name="line-130"></a>    <span class='hs-comment'>--   nm@, where @nm@ is a new modifier).  In all cases, the</span>
<a name="line-131"></a>    <span class='hs-comment'>--   underlying layout will also receive the message as usual,</span>
<a name="line-132"></a>    <span class='hs-comment'>--   after the message has been processed by 'handleMess'.</span>
<a name="line-133"></a>    <span class='hs-comment'>--</span>
<a name="line-134"></a>    <span class='hs-comment'>--   If you wish to possibly modify a message before it reaches</span>
<a name="line-135"></a>    <span class='hs-comment'>--   the underlying layout, you should use</span>
<a name="line-136"></a>    <span class='hs-comment'>--   'handleMessOrMaybeModifyIt' instead.  If you do not need to</span>
<a name="line-137"></a>    <span class='hs-comment'>--   modify messages or have access to the X monad, you should use</span>
<a name="line-138"></a>    <span class='hs-comment'>--   'pureMess' instead.</span>
<a name="line-139"></a>    <span class='hs-comment'>--</span>
<a name="line-140"></a>    <span class='hs-comment'>--   The default implementation of 'handleMess' calls 'unhook'</span>
<a name="line-141"></a>    <span class='hs-comment'>--   when receiving a 'Hide' or 'ReleaseResources' method (after</span>
<a name="line-142"></a>    <span class='hs-comment'>--   which it returns @Nothing@), and otherwise passes the message</span>
<a name="line-143"></a>    <span class='hs-comment'>--   on to 'pureMess'.</span>
<a name="line-144"></a>    <span class='hs-varid'>handleMess</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-145"></a>    <span class='hs-varid'>handleMess</span> <span class='hs-varid'>m</span> <span class='hs-varid'>mess</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Hide</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fromMessage</span> <span class='hs-varid'>mess</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>doUnhook</span>
<a name="line-146"></a>                      <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>ReleaseResources</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fromMessage</span> <span class='hs-varid'>mess</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>doUnhook</span>
<a name="line-147"></a>                      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pureMess</span> <span class='hs-varid'>m</span> <span class='hs-varid'>mess</span>
<a name="line-148"></a>     <span class='hs-keyword'>where</span> <span class='hs-varid'>doUnhook</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>unhook</span> <span class='hs-varid'>m</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-149"></a>
<a name="line-150"></a>    <span class='hs-comment'>-- | 'handleMessOrMaybeModifyIt' allows you to intercept messages</span>
<a name="line-151"></a>    <span class='hs-comment'>--   sent to the underlying layout, in order to have an effect in</span>
<a name="line-152"></a>    <span class='hs-comment'>--   the X monad, alter the layout modifier state, or produce a</span>
<a name="line-153"></a>    <span class='hs-comment'>--   modified message to be passed on to the underlying layout.</span>
<a name="line-154"></a>    <span class='hs-comment'>--</span>
<a name="line-155"></a>    <span class='hs-comment'>--   The default implementation of 'handleMessOrMaybeModifyIt'</span>
<a name="line-156"></a>    <span class='hs-comment'>--   simply passes on the message to 'handleMess'.</span>
<a name="line-157"></a>    <span class='hs-varid'>handleMessOrMaybeModifyIt</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-conid'>SomeMessage</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-158"></a>    <span class='hs-varid'>handleMessOrMaybeModifyIt</span> <span class='hs-varid'>m</span> <span class='hs-varid'>mess</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>mm'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>handleMess</span> <span class='hs-varid'>m</span> <span class='hs-varid'>mess</span>
<a name="line-159"></a>                                          <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>mm'</span><span class='hs-layout'>)</span>
<a name="line-160"></a>
<a name="line-161"></a>    <span class='hs-comment'>-- | 'pureMess' allows you to spy on messages sent to the</span>
<a name="line-162"></a>    <span class='hs-comment'>--   underlying layout, in order to possibly change the layout</span>
<a name="line-163"></a>    <span class='hs-comment'>--   modifier state.</span>
<a name="line-164"></a>    <span class='hs-comment'>--</span>
<a name="line-165"></a>    <span class='hs-comment'>--   The default implementation of 'pureMess' ignores messages</span>
<a name="line-166"></a>    <span class='hs-comment'>--   sent to it, and returns @Nothing@ (causing the layout</span>
<a name="line-167"></a>    <span class='hs-comment'>--   modifier to remain unchanged).</span>
<a name="line-168"></a>    <span class='hs-varid'>pureMess</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-169"></a>    <span class='hs-varid'>pureMess</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-170"></a>
<a name="line-171"></a>    <span class='hs-comment'>-- | 'redoLayout' allows you to intercept a call to 'runLayout' on</span>
<a name="line-172"></a>    <span class='hs-comment'>--   workspaces with at least one window, /after/ it is called on</span>
<a name="line-173"></a>    <span class='hs-comment'>--   the underlying layout, in order to perform some effect in the</span>
<a name="line-174"></a>    <span class='hs-comment'>--   X monad, possibly return a new layout modifier, and\/or</span>
<a name="line-175"></a>    <span class='hs-comment'>--   modify the results of 'runLayout' before returning them.</span>
<a name="line-176"></a>    <span class='hs-comment'>--</span>
<a name="line-177"></a>    <span class='hs-comment'>--   If you don't need access to the X monad, use 'pureModifier'</span>
<a name="line-178"></a>    <span class='hs-comment'>--   instead.  Also, if the behavior you need can be cleanly</span>
<a name="line-179"></a>    <span class='hs-comment'>--   separated into an effect in the X monad, followed by a pure</span>
<a name="line-180"></a>    <span class='hs-comment'>--   transformation of the results of 'runLayout', you should</span>
<a name="line-181"></a>    <span class='hs-comment'>--   consider implementing 'hook' and 'pureModifier' instead of</span>
<a name="line-182"></a>    <span class='hs-comment'>--   'redoLayout'.</span>
<a name="line-183"></a>    <span class='hs-comment'>--</span>
<a name="line-184"></a>    <span class='hs-comment'>--   On empty workspaces, the Stack is Nothing.</span>
<a name="line-185"></a>    <span class='hs-comment'>--</span>
<a name="line-186"></a>    <span class='hs-comment'>--   The default implementation of 'redoLayout' calls 'hook' and</span>
<a name="line-187"></a>    <span class='hs-comment'>--   then 'pureModifier'.</span>
<a name="line-188"></a>    <span class='hs-varid'>redoLayout</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>               <span class='hs-comment'>-- ^ the layout modifier</span>
<a name="line-189"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span>         <span class='hs-comment'>-- ^ screen rectangle</span>
<a name="line-190"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Stack</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ current window stack</span>
<a name="line-191"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- ^ (window,rectangle) pairs returned</span>
<a name="line-192"></a>                                    <span class='hs-comment'>-- by the underlying layout</span>
<a name="line-193"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-194"></a>    <span class='hs-varid'>redoLayout</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-varid'>ms</span> <span class='hs-varid'>wrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>hook</span> <span class='hs-varid'>m</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pureModifier</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-varid'>ms</span> <span class='hs-varid'>wrs</span>
<a name="line-195"></a>
<a name="line-196"></a>    <span class='hs-comment'>-- | 'pureModifier' allows you to intercept a call to 'runLayout'</span>
<a name="line-197"></a>    <span class='hs-comment'>--   /after/ it is called on the underlying layout, in order to</span>
<a name="line-198"></a>    <span class='hs-comment'>--   modify the list of window\/rectangle pairings it has returned,</span>
<a name="line-199"></a>    <span class='hs-comment'>--   and\/or return a new layout modifier.</span>
<a name="line-200"></a>    <span class='hs-comment'>--</span>
<a name="line-201"></a>    <span class='hs-comment'>--   The default implementation of 'pureModifier' returns the</span>
<a name="line-202"></a>    <span class='hs-comment'>--   window rectangles unmodified.</span>
<a name="line-203"></a>    <span class='hs-varid'>pureModifier</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>               <span class='hs-comment'>-- ^ the layout modifier</span>
<a name="line-204"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span>         <span class='hs-comment'>-- ^ screen rectangle</span>
<a name="line-205"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Stack</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ current window stack</span>
<a name="line-206"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- ^ (window, rectangle) pairs returned</span>
<a name="line-207"></a>                                      <span class='hs-comment'>-- by the underlying layout</span>
<a name="line-208"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-209"></a>    <span class='hs-varid'>pureModifier</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>wrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>wrs</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-210"></a>
<a name="line-211"></a>    <span class='hs-comment'>-- | 'hook' is called by the default implementation of</span>
<a name="line-212"></a>    <span class='hs-comment'>--   'redoLayout', and as such represents an X action which is to</span>
<a name="line-213"></a>    <span class='hs-comment'>--   be run each time 'runLayout' is called on the underlying</span>
<a name="line-214"></a>    <span class='hs-comment'>--   layout, /after/ 'runLayout' has completed.  Of course, if you</span>
<a name="line-215"></a>    <span class='hs-comment'>--   override 'redoLayout', then 'hook' will not be called unless</span>
<a name="line-216"></a>    <span class='hs-comment'>--   you explicitly call it.</span>
<a name="line-217"></a>    <span class='hs-comment'>--</span>
<a name="line-218"></a>    <span class='hs-comment'>--   The default implementation of 'hook' is @return ()@ (i.e., it</span>
<a name="line-219"></a>    <span class='hs-comment'>--   has no effect).</span>
<a name="line-220"></a>    <span class='hs-varid'>hook</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-221"></a>    <span class='hs-varid'>hook</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-222"></a>
<a name="line-223"></a>    <span class='hs-comment'>-- | 'unhook' is called by the default implementation of</span>
<a name="line-224"></a>    <span class='hs-comment'>--   'handleMess' upon receiving a 'Hide' or a 'ReleaseResources'</span>
<a name="line-225"></a>    <span class='hs-comment'>--   message.</span>
<a name="line-226"></a>    <span class='hs-comment'>--</span>
<a name="line-227"></a>    <span class='hs-comment'>--   The default implementation, of course, does nothing.</span>
<a name="line-228"></a>    <span class='hs-varid'>unhook</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-229"></a>    <span class='hs-varid'>unhook</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-230"></a>
<a name="line-231"></a>    <span class='hs-comment'>-- | 'modifierDescription' is used to give a String description to</span>
<a name="line-232"></a>    <span class='hs-comment'>--   this layout modifier.  It is the empty string by default; you</span>
<a name="line-233"></a>    <span class='hs-comment'>--   should only override this if it is important that the</span>
<a name="line-234"></a>    <span class='hs-comment'>--   presence of the layout modifier be displayed in text</span>
<a name="line-235"></a>    <span class='hs-comment'>--   representations of the layout (for example, in the status bar</span>
<a name="line-236"></a>    <span class='hs-comment'>--   of a "XMonad.Hooks.DynamicLog" user).</span>
<a name="line-237"></a>    <span class='hs-varid'>modifierDescription</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-238"></a>    <span class='hs-varid'>modifierDescription</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>const</span> <span class='hs-str'>""</span>
<a name="line-239"></a>
<a name="line-240"></a>    <span class='hs-comment'>-- | 'modifyDescription' gives a String description for the entire</span>
<a name="line-241"></a>    <span class='hs-comment'>--   layout (modifier + underlying layout).  By default, it is</span>
<a name="line-242"></a>    <span class='hs-comment'>--   derived from the concatenation of the 'modifierDescription'</span>
<a name="line-243"></a>    <span class='hs-comment'>--   with the 'description' of the underlying layout, with a</span>
<a name="line-244"></a>    <span class='hs-comment'>--   \"smart space\" in between (the space is not included if the</span>
<a name="line-245"></a>    <span class='hs-comment'>--   'modifierDescription' is empty).</span>
<a name="line-246"></a>    <span class='hs-varid'>modifyDescription</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>LayoutClass</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-247"></a>    <span class='hs-varid'>modifyDescription</span> <span class='hs-varid'>m</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>modifierDescription</span> <span class='hs-varid'>m</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>description</span> <span class='hs-varid'>l</span>
<a name="line-248"></a>        <span class='hs-keyword'>where</span> <span class='hs-str'>""</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-249"></a>              <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-varop'>++</span> <span class='hs-str'>" "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>y</span>
<a name="line-250"></a>
<a name="line-251"></a><a name="instance%20LayoutClass%20(ModifiedLayout%20m%20l)%20a"></a><span class='hs-comment'>-- | The 'LayoutClass' instance for a 'ModifiedLayout' defines the</span>
<a name="line-252"></a><a name="instance%20LayoutClass%20(ModifiedLayout%20m%20l)%20a"></a><span class='hs-comment'>--   semantics of a 'LayoutModifier' applied to an underlying layout.</span>
<a name="line-253"></a><a name="instance%20LayoutClass%20(ModifiedLayout%20m%20l)%20a"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>LayoutModifier</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>LayoutClass</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LayoutClass</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-254"></a>    <span class='hs-varid'>runLayout</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workspace</span> <span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>ms</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span>
<a name="line-255"></a>        <span class='hs-keyword'>do</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>ws</span><span class='hs-layout'>,</span> <span class='hs-varid'>ml'</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-varid'>mm'</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>modifyLayoutWithUpdate</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workspace</span> <span class='hs-varid'>i</span> <span class='hs-varid'>l</span> <span class='hs-varid'>ms</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span>
<a name="line-256"></a>           <span class='hs-layout'>(</span><span class='hs-varid'>ws'</span><span class='hs-layout'>,</span> <span class='hs-varid'>mm''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>redoLayout</span> <span class='hs-layout'>(</span><span class='hs-varid'>maybe</span> <span class='hs-varid'>m</span> <span class='hs-varid'>id</span> <span class='hs-varid'>mm'</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-varid'>ms</span> <span class='hs-varid'>ws</span>
<a name="line-257"></a>           <span class='hs-keyword'>let</span> <span class='hs-varid'>ml''</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mm''</span> <span class='hs-varop'>`mplus`</span> <span class='hs-varid'>mm'</span> <span class='hs-keyword'>of</span>
<a name="line-258"></a>                        <span class='hs-conid'>Just</span> <span class='hs-varid'>m'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m'</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>l</span> <span class='hs-varid'>id</span> <span class='hs-varid'>ml'</span>
<a name="line-259"></a>                        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>ml'</span>
<a name="line-260"></a>           <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>ws'</span><span class='hs-layout'>,</span> <span class='hs-varid'>ml''</span><span class='hs-layout'>)</span>
<a name="line-261"></a>
<a name="line-262"></a>    <span class='hs-varid'>handleMessage</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>mess</span> <span class='hs-keyglyph'>=</span>
<a name="line-263"></a>        <span class='hs-keyword'>do</span> <span class='hs-varid'>mm'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>handleMessOrMaybeModifyIt</span> <span class='hs-varid'>m</span> <span class='hs-varid'>mess</span>
<a name="line-264"></a>           <span class='hs-varid'>ml'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mm'</span> <span class='hs-keyword'>of</span>
<a name="line-265"></a>                  <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>mess'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>handleMessage</span> <span class='hs-varid'>l</span> <span class='hs-varid'>mess'</span>
<a name="line-266"></a>                  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>handleMessage</span> <span class='hs-varid'>l</span> <span class='hs-varid'>mess</span>
<a name="line-267"></a>           <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mm'</span> <span class='hs-keyword'>of</span>
<a name="line-268"></a>                    <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>m'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m'</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>l</span> <span class='hs-varid'>id</span> <span class='hs-varid'>ml'</span>
<a name="line-269"></a>                    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>ml'</span>
<a name="line-270"></a>    <span class='hs-varid'>description</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>modifyDescription</span> <span class='hs-varid'>m</span> <span class='hs-varid'>l</span>
<a name="line-271"></a>
<a name="line-272"></a><a name="ModifiedLayout"></a><span class='hs-comment'>-- | A 'ModifiedLayout' is simply a container for a layout modifier</span>
<a name="line-273"></a><a name="ModifiedLayout"></a><span class='hs-comment'>--   combined with an underlying layout.  It is, of course, itself a</span>
<a name="line-274"></a><a name="ModifiedLayout"></a><span class='hs-comment'>--   layout (i.e. an instance of 'LayoutClass').</span>
<a name="line-275"></a><a name="ModifiedLayout"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ModifiedLayout</span> <span class='hs-varid'>m</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModifiedLayout</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Read</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>)</span>
<a name="line-276"></a>
<a name="line-277"></a><span class='hs-comment'>-- N.B. I think there is a Haddock bug here; the Haddock output for</span>
<a name="line-278"></a><span class='hs-comment'>-- the above does not parenthesize (m a) and (l a), which is obviously</span>
<a name="line-279"></a><span class='hs-comment'>-- incorrect.</span>
<a name="line-280"></a>
</pre></body>
</html>
