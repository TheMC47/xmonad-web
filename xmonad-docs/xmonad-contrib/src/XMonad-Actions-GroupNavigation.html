<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>XMonad/Actions/GroupNavigation.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>----------------------------------------------------------------------</span>
<a name="line-4"></a><span class='hs-comment'>-- |</span>
<a name="line-5"></a><span class='hs-comment'>-- Module      : XMonad.Actions.GroupNavigation</span>
<a name="line-6"></a><span class='hs-comment'>-- Copyright   : (c) nzeh@cs.dal.ca</span>
<a name="line-7"></a><span class='hs-comment'>-- License     : BSD3-style (see LICENSE)</span>
<a name="line-8"></a><span class='hs-comment'>--</span>
<a name="line-9"></a><span class='hs-comment'>-- Maintainer  : nzeh@cs.dal.ca</span>
<a name="line-10"></a><span class='hs-comment'>-- Stability   : unstable</span>
<a name="line-11"></a><span class='hs-comment'>-- Portability : unportable</span>
<a name="line-12"></a><span class='hs-comment'>--</span>
<a name="line-13"></a><span class='hs-comment'>-- Provides methods for cycling through groups of windows across</span>
<a name="line-14"></a><span class='hs-comment'>-- workspaces, ignoring windows that do not belong to this group.  A</span>
<a name="line-15"></a><span class='hs-comment'>-- group consists of all windows matching a user-provided boolean</span>
<a name="line-16"></a><span class='hs-comment'>-- query.</span>
<a name="line-17"></a><span class='hs-comment'>--</span>
<a name="line-18"></a><span class='hs-comment'>-- Also provides a method for jumping back to the most recently used</span>
<a name="line-19"></a><span class='hs-comment'>-- window in any given group.</span>
<a name="line-20"></a><span class='hs-comment'>--</span>
<a name="line-21"></a><span class='hs-comment'>----------------------------------------------------------------------</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Actions</span><span class='hs-varop'>.</span><span class='hs-conid'>GroupNavigation</span> <span class='hs-layout'>(</span> <span class='hs-comment'>-- * Usage</span>
<a name="line-24"></a>                                        <span class='hs-comment'>-- $usage</span>
<a name="line-25"></a>                                        <span class='hs-conid'>Direction</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-26"></a>                                      <span class='hs-layout'>,</span> <span class='hs-varid'>nextMatch</span>
<a name="line-27"></a>                                      <span class='hs-layout'>,</span> <span class='hs-varid'>nextMatchOrDo</span>
<a name="line-28"></a>                                      <span class='hs-layout'>,</span> <span class='hs-varid'>nextMatchWithThis</span>
<a name="line-29"></a>                                      <span class='hs-layout'>,</span> <span class='hs-varid'>historyHook</span>
<a name="line-30"></a>                                      <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-31"></a>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Reader</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Foldable</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Fold</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Sequence</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Seq</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Set</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Set</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>X11</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>concatMap</span><span class='hs-layout'>,</span> <span class='hs-varid'>drop</span><span class='hs-layout'>,</span> <span class='hs-varid'>elem</span><span class='hs-layout'>,</span> <span class='hs-varid'>filter</span><span class='hs-layout'>,</span> <span class='hs-varid'>null</span><span class='hs-layout'>,</span> <span class='hs-varid'>reverse</span><span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>ManageHook</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Operations</span> <span class='hs-layout'>(</span><span class='hs-varid'>windows</span><span class='hs-layout'>,</span> <span class='hs-varid'>withFocused</span><span class='hs-layout'>)</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>StackSet</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>SS</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Util</span><span class='hs-varop'>.</span><span class='hs-conid'>ExtensibleState</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>XS</span>
<a name="line-44"></a>
<a name="line-45"></a><span class='hs-comment'>{- $usage
<a name="line-46"></a>
<a name="line-47"></a>Import the module into your @~\/.xmonad\/xmonad.hs@:
<a name="line-48"></a>
<a name="line-49"></a>&gt; import XMonad.Actions.GroupNavigation
<a name="line-50"></a>
<a name="line-51"></a>To support cycling forward and backward through all xterm windows, add
<a name="line-52"></a>something like this to your keybindings:
<a name="line-53"></a>
<a name="line-54"></a>&gt; , ((modm              , xK_t), nextMatch Forward  (className =? "XTerm"))
<a name="line-55"></a>&gt; , ((modm .|. shiftMask, xK_t), nextMatch Backward (className =? "XTerm"))
<a name="line-56"></a>
<a name="line-57"></a>These key combinations do nothing if there is no xterm window open.
<a name="line-58"></a>If you rather want to open a new xterm window if there is no open
<a name="line-59"></a>xterm window, use 'nextMatchOrDo' instead:
<a name="line-60"></a>
<a name="line-61"></a>&gt; , ((modm              , xK_t), nextMatchOrDo Forward  (className =? "XTerm") (spawn "xterm"))
<a name="line-62"></a>&gt; , ((modm .|. shiftMask, xK_t), nextMatchOrDo Backward (className =? "XTerm") (spawn "xterm"))
<a name="line-63"></a>
<a name="line-64"></a>You can use 'nextMatchWithThis' with an arbitrary query to cycle
<a name="line-65"></a>through all windows for which this query returns the same value as the
<a name="line-66"></a>current window.  For example, to cycle through all windows in the same
<a name="line-67"></a>window class as the current window use:
<a name="line-68"></a>
<a name="line-69"></a>&gt; , ((modm , xK_f), nextMatchWithThis Forward  className)
<a name="line-70"></a>&gt; , ((modm , xK_b), nextMatchWithThis Backward className)
<a name="line-71"></a>
<a name="line-72"></a>Finally, you can define keybindings to jump to the most recent window
<a name="line-73"></a>matching a certain Boolean query.  To do this, you need to add
<a name="line-74"></a>'historyHook' to your logHook:
<a name="line-75"></a>
<a name="line-76"></a>&gt; main = xmonad $ defaultConfig { logHook = historyHook }
<a name="line-77"></a>
<a name="line-78"></a>Then the following keybindings, for example, allow you to return to
<a name="line-79"></a>the most recent xterm or emacs window or to simply to the most recent
<a name="line-80"></a>window:
<a name="line-81"></a>
<a name="line-82"></a>&gt; , ((modm .|. controlMask, xK_e),         nextMatch History (className =? "Emacs"))
<a name="line-83"></a>&gt; , ((modm .|. controlMask, xK_t),         nextMatch History (className =? "XTerm"))
<a name="line-84"></a>&gt; , ((modm                , xK_BackSpace), nextMatch History (return True))
<a name="line-85"></a>
<a name="line-86"></a>Again, you can use 'nextMatchOrDo' instead of 'nextMatch' if you want
<a name="line-87"></a>to execute an action if no window matching the query exists. -}</span>
<a name="line-88"></a>
<a name="line-89"></a><span class='hs-comment'>--- Basic cyclic navigation based on queries -------------------------</span>
<a name="line-90"></a>
<a name="line-91"></a><a name="Direction"></a><span class='hs-comment'>-- | The direction in which to look for the next match</span>
<a name="line-92"></a><a name="Direction"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Direction</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Forward</span>  <span class='hs-comment'>-- ^ Forward from current window or workspace</span>
<a name="line-93"></a>               <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Backward</span> <span class='hs-comment'>-- ^ Backward from current window or workspace</span>
<a name="line-94"></a>               <span class='hs-keyglyph'>|</span> <span class='hs-conid'>History</span>  <span class='hs-comment'>-- ^ Backward in history</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="nextMatchWithThis"></a><span class='hs-comment'>-- | Focuses the next window for which the given query produces the</span>
<a name="line-97"></a><span class='hs-comment'>-- same result as the currently focused window.  Does nothing if there</span>
<a name="line-98"></a><span class='hs-comment'>-- is no focused window (i.e., the current workspace is empty).</span>
<a name="line-99"></a><span class='hs-definition'>nextMatchWithThis</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Direction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Query</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-100"></a><span class='hs-definition'>nextMatchWithThis</span> <span class='hs-varid'>dir</span> <span class='hs-varid'>qry</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withFocused</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>win</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-101"></a>  <span class='hs-varid'>prop</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>runQuery</span> <span class='hs-varid'>qry</span> <span class='hs-varid'>win</span>
<a name="line-102"></a>  <span class='hs-varid'>nextMatch</span> <span class='hs-varid'>dir</span> <span class='hs-layout'>(</span><span class='hs-varid'>qry</span> <span class='hs-varop'>=?</span> <span class='hs-varid'>prop</span><span class='hs-layout'>)</span>
<a name="line-103"></a>
<a name="line-104"></a><a name="nextMatch"></a><span class='hs-comment'>-- | Focuses the next window that matches the given boolean query.</span>
<a name="line-105"></a><span class='hs-comment'>-- Does nothing if there is no such window.  This is the same as</span>
<a name="line-106"></a><span class='hs-comment'>-- 'nextMatchOrDo' with alternate action @return ()@.</span>
<a name="line-107"></a><span class='hs-definition'>nextMatch</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Direction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Query</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-108"></a><span class='hs-definition'>nextMatch</span> <span class='hs-varid'>dir</span> <span class='hs-varid'>qry</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nextMatchOrDo</span> <span class='hs-varid'>dir</span> <span class='hs-varid'>qry</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-109"></a>
<a name="line-110"></a><a name="nextMatchOrDo"></a><span class='hs-comment'>-- | Focuses the next window that matches the given boolean query.  If</span>
<a name="line-111"></a><span class='hs-comment'>-- there is no such window, perform the given action instead.</span>
<a name="line-112"></a><span class='hs-definition'>nextMatchOrDo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Direction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Query</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-113"></a><span class='hs-definition'>nextMatchOrDo</span> <span class='hs-varid'>dir</span> <span class='hs-varid'>qry</span> <span class='hs-varid'>act</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>orderedWindowList</span> <span class='hs-varid'>dir</span>
<a name="line-114"></a>                            <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>focusNextMatchOrDo</span> <span class='hs-varid'>qry</span> <span class='hs-varid'>act</span>
<a name="line-115"></a>
<a name="line-116"></a><a name="focusNextMatchOrDo"></a><span class='hs-comment'>-- Produces the action to perform depending on whether there's a</span>
<a name="line-117"></a><span class='hs-comment'>-- matching window</span>
<a name="line-118"></a><span class='hs-definition'>focusNextMatchOrDo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Query</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-conid'>Window</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-119"></a><span class='hs-definition'>focusNextMatchOrDo</span> <span class='hs-varid'>qry</span> <span class='hs-varid'>act</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>findM</span> <span class='hs-layout'>(</span><span class='hs-varid'>runQuery</span> <span class='hs-varid'>qry</span><span class='hs-layout'>)</span>
<a name="line-120"></a>                             <span class='hs-varop'>&gt;=&gt;</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>act</span> <span class='hs-layout'>(</span><span class='hs-varid'>windows</span> <span class='hs-varop'>.</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>focusWindow</span><span class='hs-layout'>)</span>
<a name="line-121"></a>
<a name="line-122"></a><a name="orderedWindowList"></a><span class='hs-comment'>-- Returns the list of windows ordered by workspace as specified in</span>
<a name="line-123"></a><span class='hs-comment'>-- ~/.xmonad/xmonad.hs</span>
<a name="line-124"></a><span class='hs-definition'>orderedWindowList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Direction</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-conid'>Seq</span> <span class='hs-conid'>Window</span><span class='hs-layout'>)</span>
<a name="line-125"></a><span class='hs-definition'>orderedWindowList</span> <span class='hs-conid'>History</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>HistoryDB</span> <span class='hs-varid'>w</span> <span class='hs-varid'>ws</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>ws</span> <span class='hs-layout'>(</span><span class='hs-varid'>ws</span> <span class='hs-varop'>|&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span> <span class='hs-conid'>XS</span><span class='hs-varop'>.</span><span class='hs-varid'>get</span>
<a name="line-126"></a><span class='hs-definition'>orderedWindowList</span> <span class='hs-varid'>dir</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withWindowSet</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ss</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-127"></a>  <span class='hs-varid'>wsids</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>asks</span> <span class='hs-layout'>(</span><span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>.</span> <span class='hs-varid'>workspaces</span> <span class='hs-varop'>.</span> <span class='hs-varid'>config</span><span class='hs-layout'>)</span>
<a name="line-128"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>wspcs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>orderedWorkspaceList</span> <span class='hs-varid'>ss</span> <span class='hs-varid'>wsids</span>
<a name="line-129"></a>      <span class='hs-varid'>wins</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dirfun</span> <span class='hs-varid'>dir</span>
<a name="line-130"></a>              <span class='hs-varop'>$</span> <span class='hs-conid'>Fold</span><span class='hs-varop'>.</span><span class='hs-varid'>foldl'</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&lt;</span><span class='hs-layout'>)</span> <span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-131"></a>              <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>.</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>integrate'</span> <span class='hs-varop'>.</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>stack</span><span class='hs-layout'>)</span> <span class='hs-varid'>wspcs</span>
<a name="line-132"></a>      <span class='hs-varid'>cur</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>peek</span> <span class='hs-varid'>ss</span>
<a name="line-133"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>wins</span> <span class='hs-layout'>(</span><span class='hs-varid'>rotfun</span> <span class='hs-varid'>wins</span><span class='hs-layout'>)</span> <span class='hs-varid'>cur</span>
<a name="line-134"></a>  <span class='hs-keyword'>where</span>
<a name="line-135"></a>    <span class='hs-varid'>dirfun</span> <span class='hs-conid'>Backward</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>reverse</span>
<a name="line-136"></a>    <span class='hs-varid'>dirfun</span> <span class='hs-keyword'>_</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-137"></a>    <span class='hs-varid'>rotfun</span> <span class='hs-varid'>wins</span> <span class='hs-varid'>x</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rotate</span> <span class='hs-varop'>$</span> <span class='hs-varid'>rotateTo</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>wins</span>
<a name="line-138"></a>
<a name="line-139"></a><a name="orderedWorkspaceList"></a><span class='hs-comment'>-- Returns the ordered workspace list as specified in ~/.xmonad/xmonad.hs</span>
<a name="line-140"></a><span class='hs-definition'>orderedWorkspaceList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>WindowSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-conid'>WindowSpace</span>
<a name="line-141"></a><span class='hs-definition'>orderedWorkspaceList</span> <span class='hs-varid'>ss</span> <span class='hs-varid'>wsids</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rotateTo</span> <span class='hs-varid'>isCurWS</span> <span class='hs-varid'>wspcs'</span>
<a name="line-142"></a>    <span class='hs-keyword'>where</span>
<a name="line-143"></a>      <span class='hs-varid'>wspcs</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>workspaces</span> <span class='hs-varid'>ss</span>
<a name="line-144"></a>      <span class='hs-varid'>wspcsMap</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Fold</span><span class='hs-varop'>.</span><span class='hs-varid'>foldl'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>m</span> <span class='hs-varid'>ws</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>insert</span> <span class='hs-layout'>(</span><span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>tag</span> <span class='hs-varid'>ws</span><span class='hs-layout'>)</span> <span class='hs-varid'>ws</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span> <span class='hs-varid'>wspcs</span>
<a name="line-145"></a>      <span class='hs-varid'>wspcs'</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>wsid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>wspcsMap</span> <span class='hs-varop'>!</span> <span class='hs-varid'>wsid</span><span class='hs-layout'>)</span> <span class='hs-varid'>wsids</span>
<a name="line-146"></a>      <span class='hs-varid'>isCurWS</span> <span class='hs-varid'>ws</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>tag</span> <span class='hs-varid'>ws</span> <span class='hs-varop'>==</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>tag</span> <span class='hs-layout'>(</span><span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>workspace</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>current</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>
<a name="line-147"></a>
<a name="line-148"></a><span class='hs-comment'>--- History navigation, requires a layout modifier -------------------</span>
<a name="line-149"></a>
<a name="line-150"></a><a name="HistoryDB"></a><span class='hs-comment'>-- The state extension that holds the history information</span>
<a name="line-151"></a><a name="HistoryDB"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HistoryDB</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HistoryDB</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Window</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- currently focused window</span>
<a name="line-152"></a>                           <span class='hs-layout'>(</span><span class='hs-conid'>Seq</span> <span class='hs-conid'>Window</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- previously focused windows</span>
<a name="line-153"></a>               <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Read</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-154"></a>
<a name="line-155"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>ExtensionClass</span> <span class='hs-conid'>HistoryDB</span> <span class='hs-keyword'>where</span>
<a name="line-156"></a>
<a name="line-157"></a>    <span class='hs-varid'>initialValue</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HistoryDB</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-158"></a>    <span class='hs-varid'>extensionType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PersistentExtension</span>
<a name="line-159"></a>
<a name="line-160"></a><a name="historyHook"></a><span class='hs-comment'>-- | Action that needs to be executed as a logHook to maintain the</span>
<a name="line-161"></a><span class='hs-comment'>-- focus history of all windows as the WindowSet changes.</span>
<a name="line-162"></a><span class='hs-definition'>historyHook</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-163"></a><span class='hs-definition'>historyHook</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XS</span><span class='hs-varop'>.</span><span class='hs-varid'>get</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>updateHistory</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-conid'>XS</span><span class='hs-varop'>.</span><span class='hs-varid'>put</span>
<a name="line-164"></a>
<a name="line-165"></a><a name="updateHistory"></a><span class='hs-comment'>-- Updates the history in response to a WindowSet change</span>
<a name="line-166"></a><span class='hs-definition'>updateHistory</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HistoryDB</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>HistoryDB</span>
<a name="line-167"></a><span class='hs-definition'>updateHistory</span> <span class='hs-layout'>(</span><span class='hs-conid'>HistoryDB</span> <span class='hs-varid'>oldcur</span> <span class='hs-varid'>oldhist</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withWindowSet</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ss</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-168"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>newcur</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>peek</span> <span class='hs-varid'>ss</span>
<a name="line-169"></a>      <span class='hs-varid'>wins</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SS</span><span class='hs-varop'>.</span><span class='hs-varid'>allWindows</span> <span class='hs-varid'>ss</span>
<a name="line-170"></a>      <span class='hs-varid'>newhist</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flt</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>member</span> <span class='hs-varid'>wins</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ins</span> <span class='hs-varid'>oldcur</span> <span class='hs-varid'>oldhist</span><span class='hs-layout'>)</span>
<a name="line-171"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HistoryDB</span> <span class='hs-varid'>newcur</span> <span class='hs-layout'>(</span><span class='hs-varid'>del</span> <span class='hs-varid'>newcur</span> <span class='hs-varid'>newhist</span><span class='hs-layout'>)</span>
<a name="line-172"></a>  <span class='hs-keyword'>where</span>
<a name="line-173"></a>    <span class='hs-varid'>ins</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;|</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span>
<a name="line-174"></a>    <span class='hs-varid'>del</span> <span class='hs-varid'>x</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>xs</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>flt</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span> <span class='hs-varid'>x'</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span>
<a name="line-175"></a>
<a name="line-176"></a><span class='hs-comment'>--- Two replacements for Seq.filter and Seq.breakl available only in</span>
<a name="line-177"></a><span class='hs-comment'>--- containers-0.3.0.0, which only ships with ghc 6.12.  Once we</span>
<a name="line-178"></a><span class='hs-comment'>--- decide to no longer support ghc &lt; 6.12, these should be replaced</span>
<a name="line-179"></a><span class='hs-comment'>--- with Seq.filter and Seq.breakl.</span>
<a name="line-180"></a>
<a name="line-181"></a><a name="flt"></a><span class='hs-definition'>flt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span>
<a name="line-182"></a><span class='hs-definition'>flt</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Fold</span><span class='hs-varop'>.</span><span class='hs-varid'>foldl</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>xs</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>p</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>xs</span> <span class='hs-varop'>|&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-183"></a>
<a name="line-184"></a><a name="brkl"></a><span class='hs-definition'>brkl</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-185"></a><span class='hs-definition'>brkl</span> <span class='hs-varid'>p</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>splitAt</span> <span class='hs-varid'>xs</span>
<a name="line-186"></a>            <span class='hs-varop'>$</span> <span class='hs-varid'>snd</span>
<a name="line-187"></a>            <span class='hs-varop'>$</span> <span class='hs-conid'>Fold</span><span class='hs-varop'>.</span><span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>p</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>then</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>,</span> <span class='hs-varid'>i</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-188"></a>  <span class='hs-keyword'>where</span>
<a name="line-189"></a>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>length</span> <span class='hs-varid'>xs</span>
<a name="line-190"></a>
<a name="line-191"></a><span class='hs-comment'>--- Some sequence helpers --------------------------------------------</span>
<a name="line-192"></a>
<a name="line-193"></a><a name="rotate"></a><span class='hs-comment'>-- Rotates the sequence by one position</span>
<a name="line-194"></a><span class='hs-definition'>rotate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span>
<a name="line-195"></a><span class='hs-definition'>rotate</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rotate'</span> <span class='hs-layout'>(</span><span class='hs-varid'>viewl</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-196"></a>  <span class='hs-keyword'>where</span>
<a name="line-197"></a>    <span class='hs-varid'>rotate'</span> <span class='hs-conid'>EmptyL</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Seq</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-198"></a>    <span class='hs-varid'>rotate'</span> <span class='hs-layout'>(</span><span class='hs-varid'>x'</span> <span class='hs-conop'>:&lt;</span> <span class='hs-varid'>xs'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>xs'</span> <span class='hs-varop'>|&gt;</span> <span class='hs-varid'>x'</span>
<a name="line-199"></a>
<a name="line-200"></a><a name="rotateTo"></a><span class='hs-comment'>-- Rotates the sequence until an element matching the given condition</span>
<a name="line-201"></a><span class='hs-comment'>-- is at the beginning of the sequence.</span>
<a name="line-202"></a><span class='hs-definition'>rotateTo</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span>
<a name="line-203"></a><span class='hs-definition'>rotateTo</span> <span class='hs-varid'>cond</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>lxs</span><span class='hs-layout'>,</span> <span class='hs-varid'>rxs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brkl</span> <span class='hs-varid'>cond</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>in</span> <span class='hs-varid'>rxs</span> <span class='hs-varop'>&gt;&lt;</span> <span class='hs-varid'>lxs</span>
<a name="line-204"></a>
<a name="line-205"></a><span class='hs-comment'>--- A monadic find ---------------------------------------------------</span>
<a name="line-206"></a>
<a name="line-207"></a><a name="findM"></a><span class='hs-comment'>-- Applies the given action to every sequence element in turn until</span>
<a name="line-208"></a><span class='hs-comment'>-- the first element is found for which the action returns true.  The</span>
<a name="line-209"></a><span class='hs-comment'>-- remaining elements in the sequence are ignored.</span>
<a name="line-210"></a><span class='hs-definition'>findM</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Seq</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-211"></a><span class='hs-definition'>findM</span> <span class='hs-varid'>cond</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>findM'</span> <span class='hs-varid'>cond</span> <span class='hs-layout'>(</span><span class='hs-varid'>viewl</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-212"></a>  <span class='hs-keyword'>where</span>
<a name="line-213"></a>    <span class='hs-varid'>findM'</span> <span class='hs-keyword'>_</span>   <span class='hs-conid'>EmptyL</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-214"></a>    <span class='hs-varid'>findM'</span> <span class='hs-varid'>qry</span> <span class='hs-layout'>(</span><span class='hs-varid'>x'</span> <span class='hs-conop'>:&lt;</span> <span class='hs-varid'>xs'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-215"></a>      <span class='hs-varid'>isMatch</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>qry</span> <span class='hs-varid'>x'</span>
<a name="line-216"></a>      <span class='hs-keyword'>if</span> <span class='hs-varid'>isMatch</span>
<a name="line-217"></a>        <span class='hs-keyword'>then</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>x'</span><span class='hs-layout'>)</span>
<a name="line-218"></a>        <span class='hs-keyword'>else</span> <span class='hs-varid'>findM</span> <span class='hs-varid'>qry</span> <span class='hs-varid'>xs'</span>
</pre></body>
</html>
