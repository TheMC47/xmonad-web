<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>XMonad/Core.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE ExistentialQuantification, FlexibleInstances, GeneralizedNewtypeDeriving,
<a name="line-2"></a>             MultiParamTypeClasses, TypeSynonymInstances, CPP, DeriveDataTypeable #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-5"></a><span class='hs-comment'>-- |</span>
<a name="line-6"></a><span class='hs-comment'>-- Module      :  XMonad.Core</span>
<a name="line-7"></a><span class='hs-comment'>-- Copyright   :  (c) Spencer Janssen 2007</span>
<a name="line-8"></a><span class='hs-comment'>-- License     :  BSD3-style (see LICENSE)</span>
<a name="line-9"></a><span class='hs-comment'>--</span>
<a name="line-10"></a><span class='hs-comment'>-- Maintainer  :  spencerjanssen@gmail.com</span>
<a name="line-11"></a><span class='hs-comment'>-- Stability   :  unstable</span>
<a name="line-12"></a><span class='hs-comment'>-- Portability :  not portable, uses cunning newtype deriving</span>
<a name="line-13"></a><span class='hs-comment'>--</span>
<a name="line-14"></a><span class='hs-comment'>-- The 'X' monad, a state monad transformer over 'IO', for the window</span>
<a name="line-15"></a><span class='hs-comment'>-- manager state, and support routines.</span>
<a name="line-16"></a><span class='hs-comment'>--</span>
<a name="line-17"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span> <span class='hs-layout'>(</span>
<a name="line-20"></a>    <span class='hs-conid'>X</span><span class='hs-layout'>,</span> <span class='hs-conid'>WindowSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>WindowSpace</span><span class='hs-layout'>,</span> <span class='hs-conid'>WorkspaceId</span><span class='hs-layout'>,</span>
<a name="line-21"></a>    <span class='hs-conid'>ScreenId</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ScreenDetail</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>XState</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-22"></a>    <span class='hs-conid'>XConf</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>XConfig</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LayoutClass</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-23"></a>    <span class='hs-conid'>Layout</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>readsLayout</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Message</span><span class='hs-layout'>,</span>
<a name="line-24"></a>    <span class='hs-conid'>SomeMessage</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromMessage</span><span class='hs-layout'>,</span> <span class='hs-conid'>LayoutMessages</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-25"></a>    <span class='hs-conid'>StateExtension</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ExtensionClass</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-26"></a>    <span class='hs-varid'>runX</span><span class='hs-layout'>,</span> <span class='hs-varid'>catchX</span><span class='hs-layout'>,</span> <span class='hs-varid'>userCode</span><span class='hs-layout'>,</span> <span class='hs-varid'>userCodeDef</span><span class='hs-layout'>,</span> <span class='hs-varid'>io</span><span class='hs-layout'>,</span> <span class='hs-varid'>catchIO</span><span class='hs-layout'>,</span> <span class='hs-varid'>installSignalHandlers</span><span class='hs-layout'>,</span> <span class='hs-varid'>uninstallSignalHandlers</span><span class='hs-layout'>,</span>
<a name="line-27"></a>    <span class='hs-varid'>withDisplay</span><span class='hs-layout'>,</span> <span class='hs-varid'>withWindowSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>isRoot</span><span class='hs-layout'>,</span> <span class='hs-varid'>runOnWorkspaces</span><span class='hs-layout'>,</span>
<a name="line-28"></a>    <span class='hs-varid'>getAtom</span><span class='hs-layout'>,</span> <span class='hs-varid'>spawn</span><span class='hs-layout'>,</span> <span class='hs-varid'>spawnPID</span><span class='hs-layout'>,</span> <span class='hs-varid'>xfork</span><span class='hs-layout'>,</span> <span class='hs-varid'>getXMonadDir</span><span class='hs-layout'>,</span> <span class='hs-varid'>recompile</span><span class='hs-layout'>,</span> <span class='hs-varid'>trace</span><span class='hs-layout'>,</span> <span class='hs-varid'>whenJust</span><span class='hs-layout'>,</span> <span class='hs-varid'>whenX</span><span class='hs-layout'>,</span>
<a name="line-29"></a>    <span class='hs-varid'>atom_WM_STATE</span><span class='hs-layout'>,</span> <span class='hs-varid'>atom_WM_PROTOCOLS</span><span class='hs-layout'>,</span> <span class='hs-varid'>atom_WM_DELETE_WINDOW</span><span class='hs-layout'>,</span> <span class='hs-varid'>atom_WM_TAKE_FOCUS</span><span class='hs-layout'>,</span> <span class='hs-conid'>ManageHook</span><span class='hs-layout'>,</span> <span class='hs-conid'>Query</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>runQuery</span>
<a name="line-30"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-31"></a>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>XMonad</span><span class='hs-varop'>.</span><span class='hs-conid'>StackSet</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>modify</span><span class='hs-layout'>)</span>
<a name="line-33"></a>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span> <span class='hs-varid'>catch</span> <span class='hs-layout'>)</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Codec</span><span class='hs-varop'>.</span><span class='hs-conid'>Binary</span><span class='hs-varop'>.</span><span class='hs-conid'>UTF8</span><span class='hs-varop'>.</span><span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-varid'>encodeString</span><span class='hs-layout'>)</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span><span class='hs-varop'>.</span><span class='hs-conid'>Extensible</span> <span class='hs-layout'>(</span><span class='hs-varid'>catch</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromException</span><span class='hs-layout'>,</span> <span class='hs-varid'>try</span><span class='hs-layout'>,</span> <span class='hs-varid'>bracket</span><span class='hs-layout'>,</span> <span class='hs-varid'>throw</span><span class='hs-layout'>,</span> <span class='hs-varid'>finally</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeException</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>State</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Reader</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>FilePath</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Info</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Posix</span><span class='hs-varop'>.</span><span class='hs-conid'>Process</span> <span class='hs-layout'>(</span><span class='hs-varid'>executeFile</span><span class='hs-layout'>,</span> <span class='hs-varid'>forkProcess</span><span class='hs-layout'>,</span> <span class='hs-varid'>getAnyProcessStatus</span><span class='hs-layout'>,</span> <span class='hs-varid'>createSession</span><span class='hs-layout'>)</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Posix</span><span class='hs-varop'>.</span><span class='hs-conid'>Signals</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Posix</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Posix</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span> <span class='hs-layout'>(</span><span class='hs-conid'>ProcessID</span><span class='hs-layout'>)</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Process</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Directory</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Exit</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>X11</span><span class='hs-varop'>.</span><span class='hs-conid'>Xlib</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>X11</span><span class='hs-varop'>.</span><span class='hs-conid'>Xlib</span><span class='hs-varop'>.</span><span class='hs-conid'>Extras</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span><span class='hs-layout'>)</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>\\</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-54"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>isJust</span><span class='hs-layout'>,</span><span class='hs-varid'>fromMaybe</span><span class='hs-layout'>)</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Monoid</span>
<a name="line-56"></a>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>M</span>
<a name="line-58"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Set</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>S</span>
<a name="line-59"></a>
<a name="line-60"></a><a name="XState"></a><span class='hs-comment'>-- | XState, the (mutable) window manager state.</span>
<a name="line-61"></a><a name="XState"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>XState</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XState</span>
<a name="line-62"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>windowset</span>        <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>WindowSet</span>                     <span class='hs-comment'>-- ^ workspace list</span>
<a name="line-63"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>mapped</span>           <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>S</span><span class='hs-varop'>.</span><span class='hs-conid'>Set</span> <span class='hs-conid'>Window</span><span class='hs-layout'>)</span>                <span class='hs-comment'>-- ^ the Set of mapped windows</span>
<a name="line-64"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>waitingUnmap</span>     <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-conid'>Window</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>            <span class='hs-comment'>-- ^ the number of expected UnmapEvents</span>
<a name="line-65"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>dragging</span>         <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Position</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Position</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>,</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-66"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>numberlockMask</span>   <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>KeyMask</span>                       <span class='hs-comment'>-- ^ The numlock modifier</span>
<a name="line-67"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>extensibleState</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-conid'>StateExtension</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-68"></a>    <span class='hs-comment'>-- ^ stores custom state information.</span>
<a name="line-69"></a>    <span class='hs-comment'>--</span>
<a name="line-70"></a>    <span class='hs-comment'>-- The module "XMonad.Utils.ExtensibleState" in xmonad-contrib</span>
<a name="line-71"></a>    <span class='hs-comment'>-- provides additional information and a simple interface for using this.</span>
<a name="line-72"></a>    <span class='hs-layout'>}</span>
<a name="line-73"></a>
<a name="line-74"></a><a name="XConf"></a><span class='hs-comment'>-- | XConf, the (read-only) window manager configuration.</span>
<a name="line-75"></a><a name="XConf"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>XConf</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XConf</span>
<a name="line-76"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>display</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Display</span>        <span class='hs-comment'>-- ^ the X11 display</span>
<a name="line-77"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>config</span>        <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XConfig</span> <span class='hs-conid'>Layout</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ initial user configuration</span>
<a name="line-78"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>theRoot</span>       <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Window</span>        <span class='hs-comment'>-- ^ the root window</span>
<a name="line-79"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>normalBorder</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Pixel</span>         <span class='hs-comment'>-- ^ border color of unfocused windows</span>
<a name="line-80"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>focusedBorder</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Pixel</span>         <span class='hs-comment'>-- ^ border color of the focused window</span>
<a name="line-81"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>keyActions</span>    <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>KeyMask</span><span class='hs-layout'>,</span> <span class='hs-conid'>KeySym</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-82"></a>                                      <span class='hs-comment'>-- ^ a mapping of key presses to actions</span>
<a name="line-83"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>buttonActions</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>KeyMask</span><span class='hs-layout'>,</span> <span class='hs-conid'>Button</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Window</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-84"></a>                                      <span class='hs-comment'>-- ^ a mapping of button presses to actions</span>
<a name="line-85"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>mouseFocused</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Bool</span>           <span class='hs-comment'>-- ^ was refocus caused by mouse action?</span>
<a name="line-86"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>mousePosition</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Position</span><span class='hs-layout'>,</span> <span class='hs-conid'>Position</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-87"></a>                                      <span class='hs-comment'>-- ^ position of the mouse according to</span>
<a name="line-88"></a>                                      <span class='hs-comment'>-- the event currently being processed</span>
<a name="line-89"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>currentEvent</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Event</span><span class='hs-layout'>)</span>
<a name="line-90"></a>                                      <span class='hs-comment'>-- ^ event currently being processed</span>
<a name="line-91"></a>    <span class='hs-layout'>}</span>
<a name="line-92"></a>
<a name="line-93"></a><a name="XConfig"></a><span class='hs-comment'>-- todo, better name</span>
<a name="line-94"></a><a name="XConfig"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>XConfig</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XConfig</span>
<a name="line-95"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>normalBorderColor</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>String</span>              <span class='hs-comment'>-- ^ Non focused windows border color. Default: \"#dddddd\"</span>
<a name="line-96"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>focusedBorderColor</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>String</span>              <span class='hs-comment'>-- ^ Focused windows border color. Default: \"#ff0000\"</span>
<a name="line-97"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>terminal</span>           <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>String</span>              <span class='hs-comment'>-- ^ The preferred terminal application. Default: \"xterm\"</span>
<a name="line-98"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>layoutHook</span>         <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-conid'>Window</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- ^ The available layouts</span>
<a name="line-99"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>manageHook</span>         <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>ManageHook</span>          <span class='hs-comment'>-- ^ The action to run when a new window is opened</span>
<a name="line-100"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>handleEventHook</span>    <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>All</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ Handle an X event, returns (All True) if the default handler</span>
<a name="line-101"></a>                                                 <span class='hs-comment'>-- should also be run afterwards. mappend should be used for combining</span>
<a name="line-102"></a>                                                 <span class='hs-comment'>-- event hooks in most cases.</span>
<a name="line-103"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>workspaces</span>         <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span>            <span class='hs-comment'>-- ^ The list of workspaces' names</span>
<a name="line-104"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>modMask</span>            <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>KeyMask</span>             <span class='hs-comment'>-- ^ the mod modifier</span>
<a name="line-105"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>keys</span>               <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XConfig</span> <span class='hs-conid'>Layout</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>ButtonMask</span><span class='hs-layout'>,</span><span class='hs-conid'>KeySym</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-106"></a>                                                 <span class='hs-comment'>-- ^ The key binding: a map from key presses and actions</span>
<a name="line-107"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>mouseBindings</span>      <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XConfig</span> <span class='hs-conid'>Layout</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>ButtonMask</span><span class='hs-layout'>,</span> <span class='hs-conid'>Button</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Window</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-108"></a>                                                 <span class='hs-comment'>-- ^ The mouse bindings</span>
<a name="line-109"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>borderWidth</span>        <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Dimension</span>           <span class='hs-comment'>-- ^ The border width</span>
<a name="line-110"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>logHook</span>            <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>              <span class='hs-comment'>-- ^ The action to perform when the windows set is changed</span>
<a name="line-111"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>startupHook</span>        <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>X</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>              <span class='hs-comment'>-- ^ The action to perform on startup</span>
<a name="line-112"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>focusFollowsMouse</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Bool</span>                <span class='hs-comment'>-- ^ Whether window entry events can change focus</span>
<a name="line-113"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>clickJustFocuses</span>   <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Bool</span>                <span class='hs-comment'>-- ^ False to make a click which changes focus to be additionally passed to the window</span>
<a name="line-114"></a>    <span class='hs-layout'>}</span>
<a name="line-115"></a>
<a name="line-116"></a>
<a name="line-117"></a><a name="WindowSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>WindowSet</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StackSet</span>  <span class='hs-conid'>WorkspaceId</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-conid'>Window</span><span class='hs-layout'>)</span> <span class='hs-conid'>Window</span> <span class='hs-conid'>ScreenId</span> <span class='hs-conid'>ScreenDetail</span>
<a name="line-118"></a><a name="WindowSpace"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>WindowSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Workspace</span> <span class='hs-conid'>WorkspaceId</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-conid'>Window</span><span class='hs-layout'>)</span> <span class='hs-conid'>Window</span>
<a name="line-119"></a>
<a name="line-120"></a><a name="WorkspaceId"></a><span class='hs-comment'>-- | Virtual workspace indices</span>
<a name="line-121"></a><a name="WorkspaceId"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>WorkspaceId</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>String</span>
<a name="line-122"></a>
<a name="line-123"></a><a name="ScreenId"></a><span class='hs-comment'>-- | Physical screen indices</span>
<a name="line-124"></a><a name="ScreenId"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>ScreenId</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>S</span> <span class='hs-conid'>Int</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Ord</span><span class='hs-layout'>,</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span><span class='hs-conid'>Read</span><span class='hs-layout'>,</span><span class='hs-conid'>Enum</span><span class='hs-layout'>,</span><span class='hs-conid'>Num</span><span class='hs-layout'>,</span><span class='hs-conid'>Integral</span><span class='hs-layout'>,</span><span class='hs-conid'>Real</span><span class='hs-layout'>)</span>
<a name="line-125"></a>
<a name="line-126"></a><a name="ScreenDetail"></a><span class='hs-comment'>-- | The 'Rectangle' with screen dimensions</span>
<a name="line-127"></a><a name="ScreenDetail"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ScreenDetail</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SD</span> <span class='hs-layout'>{</span> <span class='hs-varid'>screenRect</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Rectangle</span> <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span><span class='hs-layout'>)</span>
<a name="line-128"></a>
<a name="line-129"></a><span class='hs-comment'>------------------------------------------------------------------------</span>
<a name="line-130"></a>
<a name="line-131"></a><a name="X"></a><span class='hs-comment'>-- | The X monad, 'ReaderT' and 'StateT' transformers over 'IO'</span>
<a name="line-132"></a><a name="X"></a><span class='hs-comment'>-- encapsulating the window manager configuration and state,</span>
<a name="line-133"></a><a name="X"></a><span class='hs-comment'>-- respectively.</span>
<a name="line-134"></a><a name="X"></a><span class='hs-comment'>--</span>
<a name="line-135"></a><a name="X"></a><span class='hs-comment'>-- Dynamic components may be retrieved with 'get', static components</span>
<a name="line-136"></a><a name="X"></a><span class='hs-comment'>-- with 'ask'. With newtype deriving we get readers and state monads</span>
<a name="line-137"></a><a name="X"></a><span class='hs-comment'>-- instantiated on 'XConf' and 'XState' automatically.</span>
<a name="line-138"></a><a name="X"></a><span class='hs-comment'>--</span>
<a name="line-139"></a><a name="X"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReaderT</span> <span class='hs-conid'>XConf</span> <span class='hs-layout'>(</span><span class='hs-conid'>StateT</span> <span class='hs-conid'>XState</span> <span class='hs-conid'>IO</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-140"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Functor</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monad</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadIO</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadState</span> <span class='hs-conid'>XState</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadReader</span> <span class='hs-conid'>XConf</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-141"></a>
<a name="line-142"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Applicative</span> <span class='hs-conid'>X</span> <span class='hs-keyword'>where</span>
<a name="line-143"></a>  <span class='hs-varid'>pure</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span>
<a name="line-144"></a>  <span class='hs-layout'>(</span><span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ap</span>
<a name="line-145"></a>
<a name="line-146"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>X</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-147"></a>    <span class='hs-varid'>mempty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varid'>mempty</span>
<a name="line-148"></a>    <span class='hs-varid'>mappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM2</span> <span class='hs-varid'>mappend</span>
<a name="line-149"></a>
<a name="line-150"></a><a name="ManageHook"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ManageHook</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Query</span> <span class='hs-layout'>(</span><span class='hs-conid'>Endo</span> <span class='hs-conid'>WindowSet</span><span class='hs-layout'>)</span>
<a name="line-151"></a><a name="Query"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Query</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Query</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReaderT</span> <span class='hs-conid'>Window</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-152"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Functor</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monad</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadReader</span> <span class='hs-conid'>Window</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadIO</span><span class='hs-layout'>)</span>
<a name="line-153"></a>
<a name="line-154"></a><a name="runQuery"></a><span class='hs-definition'>runQuery</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Query</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Window</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span>
<a name="line-155"></a><span class='hs-definition'>runQuery</span> <span class='hs-layout'>(</span><span class='hs-conid'>Query</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runReaderT</span> <span class='hs-varid'>m</span> <span class='hs-varid'>w</span>
<a name="line-156"></a>
<a name="line-157"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Query</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-158"></a>    <span class='hs-varid'>mempty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varid'>mempty</span>
<a name="line-159"></a>    <span class='hs-varid'>mappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM2</span> <span class='hs-varid'>mappend</span>
<a name="line-160"></a>
<a name="line-161"></a><a name="runX"></a><span class='hs-comment'>-- | Run the 'X' monad, given a chunk of 'X' monad code, and an initial state</span>
<a name="line-162"></a><span class='hs-comment'>-- Return the result, and final state</span>
<a name="line-163"></a><span class='hs-definition'>runX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XConf</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>XState</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>XState</span><span class='hs-layout'>)</span>
<a name="line-164"></a><span class='hs-definition'>runX</span> <span class='hs-varid'>c</span> <span class='hs-varid'>st</span> <span class='hs-layout'>(</span><span class='hs-conid'>X</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runStateT</span> <span class='hs-layout'>(</span><span class='hs-varid'>runReaderT</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>st</span>
<a name="line-165"></a>
<a name="line-166"></a><a name="catchX"></a><span class='hs-comment'>-- | Run in the 'X' monad, and in case of exception, and catch it and log it</span>
<a name="line-167"></a><span class='hs-comment'>-- to stderr, and run the error case.</span>
<a name="line-168"></a><span class='hs-definition'>catchX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span>
<a name="line-169"></a><span class='hs-definition'>catchX</span> <span class='hs-varid'>job</span> <span class='hs-varid'>errcase</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-170"></a>    <span class='hs-varid'>st</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span>
<a name="line-171"></a>    <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>ask</span>
<a name="line-172"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>io</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runX</span> <span class='hs-varid'>c</span> <span class='hs-varid'>st</span> <span class='hs-varid'>job</span> <span class='hs-varop'>`catch`</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>fromException</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>of</span>
<a name="line-173"></a>                        <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>throw</span> <span class='hs-varid'>e</span> <span class='hs-varop'>`const`</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`asTypeOf`</span> <span class='hs-conid'>ExitSuccess</span><span class='hs-layout'>)</span>
<a name="line-174"></a>                        <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>hPrint</span> <span class='hs-varid'>stderr</span> <span class='hs-varid'>e</span><span class='hs-layout'>;</span> <span class='hs-varid'>runX</span> <span class='hs-varid'>c</span> <span class='hs-varid'>st</span> <span class='hs-varid'>errcase</span>
<a name="line-175"></a>    <span class='hs-varid'>put</span> <span class='hs-varid'>s'</span>
<a name="line-176"></a>    <span class='hs-varid'>return</span> <span class='hs-varid'>a</span>
<a name="line-177"></a>
<a name="line-178"></a><a name="userCode"></a><span class='hs-comment'>-- | Execute the argument, catching all exceptions.  Either this function or</span>
<a name="line-179"></a><span class='hs-comment'>-- 'catchX' should be used at all callsites of user customized code.</span>
<a name="line-180"></a><span class='hs-definition'>userCode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-181"></a><span class='hs-definition'>userCode</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>catchX</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>`liftM`</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-182"></a>
<a name="line-183"></a><a name="userCodeDef"></a><span class='hs-comment'>-- | Same as userCode but with a default argument to return instead of using</span>
<a name="line-184"></a><span class='hs-comment'>-- Maybe, provided for convenience.</span>
<a name="line-185"></a><span class='hs-definition'>userCodeDef</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span>
<a name="line-186"></a><span class='hs-definition'>userCodeDef</span> <span class='hs-varid'>def</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromMaybe</span> <span class='hs-varid'>def</span> <span class='hs-varop'>`liftM`</span> <span class='hs-varid'>userCode</span> <span class='hs-varid'>a</span>
<a name="line-187"></a>
<a name="line-188"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-189"></a><span class='hs-comment'>-- Convenient wrappers to state</span>
<a name="line-190"></a>
<a name="line-191"></a><a name="withDisplay"></a><span class='hs-comment'>-- | Run a monad action with the current display settings</span>
<a name="line-192"></a><span class='hs-definition'>withDisplay</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Display</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span>
<a name="line-193"></a><span class='hs-definition'>withDisplay</span>   <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asks</span> <span class='hs-varid'>display</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>f</span>
<a name="line-194"></a>
<a name="line-195"></a><a name="withWindowSet"></a><span class='hs-comment'>-- | Run a monadic action with the current stack set</span>
<a name="line-196"></a><span class='hs-definition'>withWindowSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>WindowSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-varid'>a</span>
<a name="line-197"></a><span class='hs-definition'>withWindowSet</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gets</span> <span class='hs-varid'>windowset</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>f</span>
<a name="line-198"></a>
<a name="line-199"></a><a name="isRoot"></a><span class='hs-comment'>-- | True if the given window is the root window</span>
<a name="line-200"></a><span class='hs-definition'>isRoot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Window</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>Bool</span>
<a name="line-201"></a><span class='hs-definition'>isRoot</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>w</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>asks</span> <span class='hs-varid'>theRoot</span>
<a name="line-202"></a>
<a name="line-203"></a><a name="getAtom"></a><span class='hs-comment'>-- | Wrapper for the common case of atom internment</span>
<a name="line-204"></a><span class='hs-definition'>getAtom</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>Atom</span>
<a name="line-205"></a><span class='hs-definition'>getAtom</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withDisplay</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dpy</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>io</span> <span class='hs-varop'>$</span> <span class='hs-varid'>internAtom</span> <span class='hs-varid'>dpy</span> <span class='hs-varid'>str</span> <span class='hs-conid'>False</span>
<a name="line-206"></a>
<a name="line-207"></a><a name="atom_WM_PROTOCOLS"></a><span class='hs-comment'>-- | Common non-predefined atoms</span>
<a name="line-208"></a><span class='hs-definition'>atom_WM_PROTOCOLS</span><span class='hs-layout'>,</span> <span class='hs-varid'>atom_WM_DELETE_WINDOW</span><span class='hs-layout'>,</span> <span class='hs-varid'>atom_WM_STATE</span><span class='hs-layout'>,</span> <span class='hs-varid'>atom_WM_TAKE_FOCUS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>X</span> <span class='hs-conid'>Atom</span>
<a name="line-209"></a><span class='hs-definition'>atom_WM_PROTOCOLS</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getAtom</span> <span class='hs-str'>"WM_PROTOCOLS"</span>
<a name="line-210"></a><a name="atom_WM_DELETE_WINDOW"></a><span class='hs-definition'>atom_WM_DELETE_WINDOW</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getAtom</span> <span class='hs-str'>"WM_DELETE_WINDOW"</span>
<a name="line-211"></a><a name="atom_WM_STATE"></a><span class='hs-definition'>atom_WM_STATE</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getAtom</span> <span class='hs-str'>"WM_STATE"</span>
<a name="line-212"></a><a name="atom_WM_TAKE_FOCUS"></a><span class='hs-definition'>atom_WM_TAKE_FOCUS</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getAtom</span> <span class='hs-str'>"WM_TAKE_FOCUS"</span>
<a name="line-213"></a>
<a name="line-214"></a><span class='hs-comment'>------------------------------------------------------------------------</span>
<a name="line-215"></a><span class='hs-comment'>-- LayoutClass handling. See particular instances in Operations.hs</span>
<a name="line-216"></a>
<a name="line-217"></a><a name="Layout"></a><span class='hs-comment'>-- | An existential type that can hold any object that is in 'Read'</span>
<a name="line-218"></a><a name="Layout"></a><span class='hs-comment'>--   and 'LayoutClass'.</span>
<a name="line-219"></a><a name="Layout"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>l</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>LayoutClass</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Layout</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-220"></a>
<a name="line-221"></a><a name="readsLayout"></a><span class='hs-comment'>-- | Using the 'Layout' as a witness, parse existentially wrapped windows</span>
<a name="line-222"></a><span class='hs-comment'>-- from a 'String'.</span>
<a name="line-223"></a><span class='hs-definition'>readsLayout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>String</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-224"></a><span class='hs-definition'>readsLayout</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-layout'>(</span><span class='hs-varid'>asTypeOf</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>rs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>rs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>reads</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span>
<a name="line-225"></a>
<a name="line-226"></a><a name="LayoutClass"></a><span class='hs-comment'>-- | Every layout must be an instance of 'LayoutClass', which defines</span>
<a name="line-227"></a><a name="LayoutClass"></a><span class='hs-comment'>-- the basic layout operations along with a sensible default for each.</span>
<a name="line-228"></a><a name="LayoutClass"></a><span class='hs-comment'>--</span>
<a name="line-229"></a><a name="LayoutClass"></a><span class='hs-comment'>-- Minimal complete definition:</span>
<a name="line-230"></a><a name="LayoutClass"></a><span class='hs-comment'>--</span>
<a name="line-231"></a><a name="LayoutClass"></a><span class='hs-comment'>-- * 'runLayout' || (('doLayout' || 'pureLayout') &amp;&amp; 'emptyLayout'), and</span>
<a name="line-232"></a><a name="LayoutClass"></a><span class='hs-comment'>--</span>
<a name="line-233"></a><a name="LayoutClass"></a><span class='hs-comment'>-- * 'handleMessage' || 'pureMessage'</span>
<a name="line-234"></a><a name="LayoutClass"></a><span class='hs-comment'>--</span>
<a name="line-235"></a><a name="LayoutClass"></a><span class='hs-comment'>-- You should also strongly consider implementing 'description',</span>
<a name="line-236"></a><a name="LayoutClass"></a><span class='hs-comment'>-- although it is not required.</span>
<a name="line-237"></a><a name="LayoutClass"></a><span class='hs-comment'>--</span>
<a name="line-238"></a><a name="LayoutClass"></a><span class='hs-comment'>-- Note that any code which /uses/ 'LayoutClass' methods should only</span>
<a name="line-239"></a><a name="LayoutClass"></a><span class='hs-comment'>-- ever call 'runLayout', 'handleMessage', and 'description'!  In</span>
<a name="line-240"></a><a name="LayoutClass"></a><span class='hs-comment'>-- other words, the only calls to 'doLayout', 'pureMessage', and other</span>
<a name="line-241"></a><a name="LayoutClass"></a><span class='hs-comment'>-- such methods should be from the default implementations of</span>
<a name="line-242"></a><a name="LayoutClass"></a><span class='hs-comment'>-- 'runLayout', 'handleMessage', and so on.  This ensures that the</span>
<a name="line-243"></a><a name="LayoutClass"></a><span class='hs-comment'>-- proper methods will be used, regardless of the particular methods</span>
<a name="line-244"></a><a name="LayoutClass"></a><span class='hs-comment'>-- that any 'LayoutClass' instance chooses to define.</span>
<a name="line-245"></a><a name="LayoutClass"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-varid'>layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LayoutClass</span> <span class='hs-varid'>layout</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-246"></a>
<a name="line-247"></a>    <span class='hs-comment'>-- | By default, 'runLayout' calls 'doLayout' if there are any</span>
<a name="line-248"></a>    <span class='hs-comment'>--   windows to be laid out, and 'emptyLayout' otherwise.  Most</span>
<a name="line-249"></a>    <span class='hs-comment'>--   instances of 'LayoutClass' probably do not need to implement</span>
<a name="line-250"></a>    <span class='hs-comment'>--   'runLayout'; it is only useful for layouts which wish to make</span>
<a name="line-251"></a>    <span class='hs-comment'>--   use of more of the 'Workspace' information (for example,</span>
<a name="line-252"></a>    <span class='hs-comment'>--   "XMonad.Layout.PerWorkspace").</span>
<a name="line-253"></a>    <span class='hs-varid'>runLayout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Workspace</span> <span class='hs-conid'>WorkspaceId</span> <span class='hs-layout'>(</span><span class='hs-varid'>layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-254"></a>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span>
<a name="line-255"></a>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-256"></a>    <span class='hs-varid'>runLayout</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workspace</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span> <span class='hs-varid'>ms</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>emptyLayout</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>doLayout</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>ms</span>
<a name="line-257"></a>
<a name="line-258"></a>    <span class='hs-comment'>-- | Given a 'Rectangle' in which to place the windows, and a 'Stack'</span>
<a name="line-259"></a>    <span class='hs-comment'>-- of windows, return a list of windows and their corresponding</span>
<a name="line-260"></a>    <span class='hs-comment'>-- Rectangles.  If an element is not given a Rectangle by</span>
<a name="line-261"></a>    <span class='hs-comment'>-- 'doLayout', then it is not shown on screen.  The order of</span>
<a name="line-262"></a>    <span class='hs-comment'>-- windows in this list should be the desired stacking order.</span>
<a name="line-263"></a>    <span class='hs-comment'>--</span>
<a name="line-264"></a>    <span class='hs-comment'>-- Also possibly return a modified layout (by returning @Just</span>
<a name="line-265"></a>    <span class='hs-comment'>-- newLayout@), if this layout needs to be modified (e.g. if it</span>
<a name="line-266"></a>    <span class='hs-comment'>-- keeps track of some sort of state).  Return @Nothing@ if the</span>
<a name="line-267"></a>    <span class='hs-comment'>-- layout does not need to be modified.</span>
<a name="line-268"></a>    <span class='hs-comment'>--</span>
<a name="line-269"></a>    <span class='hs-comment'>-- Layouts which do not need access to the 'X' monad ('IO', window</span>
<a name="line-270"></a>    <span class='hs-comment'>-- manager state, or configuration) and do not keep track of their</span>
<a name="line-271"></a>    <span class='hs-comment'>-- own state should implement 'pureLayout' instead of 'doLayout'.</span>
<a name="line-272"></a>    <span class='hs-varid'>doLayout</span>    <span class='hs-keyglyph'>::</span> <span class='hs-varid'>layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Stack</span> <span class='hs-varid'>a</span>
<a name="line-273"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-274"></a>    <span class='hs-varid'>doLayout</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span> <span class='hs-varid'>s</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>pureLayout</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-275"></a>
<a name="line-276"></a>    <span class='hs-comment'>-- | This is a pure version of 'doLayout', for cases where we</span>
<a name="line-277"></a>    <span class='hs-comment'>-- don't need access to the 'X' monad to determine how to lay out</span>
<a name="line-278"></a>    <span class='hs-comment'>-- the windows, and we don't need to modify the layout itself.</span>
<a name="line-279"></a>    <span class='hs-varid'>pureLayout</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varid'>layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Stack</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-280"></a>    <span class='hs-varid'>pureLayout</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>r</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>focus</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-281"></a>
<a name="line-282"></a>    <span class='hs-comment'>-- | 'emptyLayout' is called when there are no windows.</span>
<a name="line-283"></a>    <span class='hs-varid'>emptyLayout</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rectangle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rectangle</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-284"></a>    <span class='hs-varid'>emptyLayout</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-285"></a>
<a name="line-286"></a>    <span class='hs-comment'>-- | 'handleMessage' performs message handling.  If</span>
<a name="line-287"></a>    <span class='hs-comment'>-- 'handleMessage' returns @Nothing@, then the layout did not</span>
<a name="line-288"></a>    <span class='hs-comment'>-- respond to the message and the screen is not refreshed.</span>
<a name="line-289"></a>    <span class='hs-comment'>-- Otherwise, 'handleMessage' returns an updated layout and the</span>
<a name="line-290"></a>    <span class='hs-comment'>-- screen is refreshed.</span>
<a name="line-291"></a>    <span class='hs-comment'>--</span>
<a name="line-292"></a>    <span class='hs-comment'>-- Layouts which do not need access to the 'X' monad to decide how</span>
<a name="line-293"></a>    <span class='hs-comment'>-- to handle messages should implement 'pureMessage' instead of</span>
<a name="line-294"></a>    <span class='hs-comment'>-- 'handleMessage' (this restricts the risk of error, and makes</span>
<a name="line-295"></a>    <span class='hs-comment'>-- testing much easier).</span>
<a name="line-296"></a>    <span class='hs-varid'>handleMessage</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-297"></a>    <span class='hs-varid'>handleMessage</span> <span class='hs-varid'>l</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>pureMessage</span> <span class='hs-varid'>l</span>
<a name="line-298"></a>
<a name="line-299"></a>    <span class='hs-comment'>-- | Respond to a message by (possibly) changing our layout, but</span>
<a name="line-300"></a>    <span class='hs-comment'>-- taking no other action.  If the layout changes, the screen will</span>
<a name="line-301"></a>    <span class='hs-comment'>-- be refreshed.</span>
<a name="line-302"></a>    <span class='hs-varid'>pureMessage</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-303"></a>    <span class='hs-varid'>pureMessage</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-304"></a>
<a name="line-305"></a>    <span class='hs-comment'>-- | This should be a human-readable string that is used when</span>
<a name="line-306"></a>    <span class='hs-comment'>-- selecting layouts by name.  The default implementation is</span>
<a name="line-307"></a>    <span class='hs-comment'>-- 'show', which is in some cases a poor default.</span>
<a name="line-308"></a>    <span class='hs-varid'>description</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>layout</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-309"></a>    <span class='hs-varid'>description</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span>
<a name="line-310"></a>
<a name="line-311"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>LayoutClass</span> <span class='hs-conid'>Layout</span> <span class='hs-conid'>Window</span> <span class='hs-keyword'>where</span>
<a name="line-312"></a>    <span class='hs-varid'>runLayout</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workspace</span> <span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>ms</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-conid'>Layout</span><span class='hs-layout'>)</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>runLayout</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workspace</span> <span class='hs-varid'>i</span> <span class='hs-varid'>l</span> <span class='hs-varid'>ms</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span>
<a name="line-313"></a>    <span class='hs-varid'>doLayout</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-conid'>Layout</span><span class='hs-layout'>)</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>doLayout</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span> <span class='hs-varid'>s</span>
<a name="line-314"></a>    <span class='hs-varid'>emptyLayout</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-conid'>Layout</span><span class='hs-layout'>)</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>emptyLayout</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span>
<a name="line-315"></a>    <span class='hs-varid'>handleMessage</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-conid'>Layout</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>handleMessage</span> <span class='hs-varid'>l</span>
<a name="line-316"></a>    <span class='hs-varid'>description</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>description</span> <span class='hs-varid'>l</span>
<a name="line-317"></a>
<a name="line-318"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Layout</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varid'>l</span>
<a name="line-319"></a>
<a name="line-320"></a><a name="Message"></a><span class='hs-comment'>-- | Based on ideas in /An Extensible Dynamically-Typed Hierarchy of</span>
<a name="line-321"></a><a name="Message"></a><span class='hs-comment'>-- Exceptions/, Simon Marlow, 2006. Use extensible messages to the</span>
<a name="line-322"></a><a name="Message"></a><span class='hs-comment'>-- 'handleMessage' handler.</span>
<a name="line-323"></a><a name="Message"></a><span class='hs-comment'>--</span>
<a name="line-324"></a><a name="Message"></a><span class='hs-comment'>-- User-extensible messages must be a member of this class.</span>
<a name="line-325"></a><a name="Message"></a><span class='hs-comment'>--</span>
<a name="line-326"></a><a name="Message"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Typeable</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Message</span> <span class='hs-varid'>a</span>
<a name="line-327"></a>
<a name="line-328"></a><a name="SomeMessage"></a><span class='hs-comment'>-- |</span>
<a name="line-329"></a><a name="SomeMessage"></a><span class='hs-comment'>-- A wrapped value of some type in the 'Message' class.</span>
<a name="line-330"></a><a name="SomeMessage"></a><span class='hs-comment'>--</span>
<a name="line-331"></a><a name="SomeMessage"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>Message</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-varid'>a</span>
<a name="line-332"></a>
<a name="line-333"></a><a name="fromMessage"></a><span class='hs-comment'>-- |</span>
<a name="line-334"></a><span class='hs-comment'>-- And now, unwrap a given, unknown 'Message' type, performing a (dynamic)</span>
<a name="line-335"></a><span class='hs-comment'>-- type check on the result.</span>
<a name="line-336"></a><span class='hs-comment'>--</span>
<a name="line-337"></a><span class='hs-definition'>fromMessage</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Message</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SomeMessage</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>m</span>
<a name="line-338"></a><span class='hs-definition'>fromMessage</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeMessage</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cast</span> <span class='hs-varid'>m</span>
<a name="line-339"></a>
<a name="line-340"></a><span class='hs-comment'>-- X Events are valid Messages.</span>
<a name="line-341"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Message</span> <span class='hs-conid'>Event</span>
<a name="line-342"></a>
<a name="line-343"></a><a name="LayoutMessages"></a><span class='hs-comment'>-- | 'LayoutMessages' are core messages that all layouts (especially stateful</span>
<a name="line-344"></a><a name="LayoutMessages"></a><span class='hs-comment'>-- layouts) should consider handling.</span>
<a name="line-345"></a><a name="LayoutMessages"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LayoutMessages</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Hide</span>              <span class='hs-comment'>-- ^ sent when a layout becomes non-visible</span>
<a name="line-346"></a>                    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ReleaseResources</span>  <span class='hs-comment'>-- ^ sent when xmonad is exiting or restarting</span>
<a name="line-347"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-348"></a>
<a name="line-349"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Message</span> <span class='hs-conid'>LayoutMessages</span>
<a name="line-350"></a>
<a name="line-351"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-352"></a><span class='hs-comment'>-- Extensible state</span>
<a name="line-353"></a><span class='hs-comment'>--</span>
<a name="line-354"></a>
<a name="line-355"></a><a name="ExtensionClass"></a><span class='hs-comment'>-- | Every module must make the data it wants to store</span>
<a name="line-356"></a><a name="ExtensionClass"></a><span class='hs-comment'>-- an instance of this class.</span>
<a name="line-357"></a><a name="ExtensionClass"></a><span class='hs-comment'>--</span>
<a name="line-358"></a><a name="ExtensionClass"></a><span class='hs-comment'>-- Minimal complete definition: initialValue</span>
<a name="line-359"></a><a name="ExtensionClass"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Typeable</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ExtensionClass</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-360"></a>    <span class='hs-comment'>-- | Defines an initial value for the state extension</span>
<a name="line-361"></a>    <span class='hs-varid'>initialValue</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span>
<a name="line-362"></a>    <span class='hs-comment'>-- | Specifies whether the state extension should be</span>
<a name="line-363"></a>    <span class='hs-comment'>-- persistent. Setting this method to 'PersistentExtension'</span>
<a name="line-364"></a>    <span class='hs-comment'>-- will make the stored data survive restarts, but</span>
<a name="line-365"></a>    <span class='hs-comment'>-- requires a to be an instance of Read and Show.</span>
<a name="line-366"></a>    <span class='hs-comment'>--</span>
<a name="line-367"></a>    <span class='hs-comment'>-- It defaults to 'StateExtension', i.e. no persistence.</span>
<a name="line-368"></a>    <span class='hs-varid'>extensionType</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StateExtension</span>
<a name="line-369"></a>    <span class='hs-varid'>extensionType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StateExtension</span>
<a name="line-370"></a>
<a name="line-371"></a><a name="StateExtension"></a><span class='hs-comment'>-- | Existential type to store a state extension.</span>
<a name="line-372"></a><a name="StateExtension"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StateExtension</span> <span class='hs-keyglyph'>=</span>
<a name="line-373"></a>    <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>ExtensionClass</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>StateExtension</span> <span class='hs-varid'>a</span>
<a name="line-374"></a>    <span class='hs-comment'>-- ^ Non-persistent state extension</span>
<a name="line-375"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Read</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>ExtensionClass</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PersistentExtension</span> <span class='hs-varid'>a</span>
<a name="line-376"></a>    <span class='hs-comment'>-- ^ Persistent extension</span>
<a name="line-377"></a>
<a name="line-378"></a><a name="io"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-379"></a><span class='hs-comment'>-- | General utilities</span>
<a name="line-380"></a><span class='hs-comment'>--</span>
<a name="line-381"></a><span class='hs-comment'>-- Lift an 'IO' action into the 'X' monad</span>
<a name="line-382"></a><span class='hs-definition'>io</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-383"></a><span class='hs-definition'>io</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftIO</span>
<a name="line-384"></a>
<a name="line-385"></a><a name="catchIO"></a><span class='hs-comment'>-- | Lift an 'IO' action into the 'X' monad.  If the action results in an 'IO'</span>
<a name="line-386"></a><span class='hs-comment'>-- exception, log the exception to stderr and continue normal execution.</span>
<a name="line-387"></a><span class='hs-definition'>catchIO</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-388"></a><span class='hs-definition'>catchIO</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>io</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>`catch`</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>hPrint</span> <span class='hs-varid'>stderr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>hFlush</span> <span class='hs-varid'>stderr</span><span class='hs-layout'>)</span>
<a name="line-389"></a>
<a name="line-390"></a><a name="spawn"></a><span class='hs-comment'>-- | spawn. Launch an external application. Specifically, it double-forks and</span>
<a name="line-391"></a><span class='hs-comment'>-- runs the 'String' you pass as a command to \/bin\/sh.</span>
<a name="line-392"></a><span class='hs-comment'>--</span>
<a name="line-393"></a><span class='hs-comment'>-- Note this function assumes your locale uses utf8.</span>
<a name="line-394"></a><span class='hs-definition'>spawn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-395"></a><span class='hs-definition'>spawn</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>spawnPID</span> <span class='hs-varid'>x</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-396"></a>
<a name="line-397"></a><a name="spawnPID"></a><span class='hs-comment'>-- | Like 'spawn', but returns the 'ProcessID' of the launched application</span>
<a name="line-398"></a><span class='hs-definition'>spawnPID</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>ProcessID</span>
<a name="line-399"></a><span class='hs-definition'>spawnPID</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>xfork</span> <span class='hs-varop'>$</span> <span class='hs-varid'>executeFile</span> <span class='hs-str'>"/bin/sh"</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"-c"</span><span class='hs-layout'>,</span> <span class='hs-varid'>encodeString</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>Nothing</span>
<a name="line-400"></a>
<a name="line-401"></a><a name="xfork"></a><span class='hs-comment'>-- | A replacement for 'forkProcess' which resets default signal handlers.</span>
<a name="line-402"></a><span class='hs-definition'>xfork</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>ProcessID</span>
<a name="line-403"></a><span class='hs-definition'>xfork</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>io</span> <span class='hs-varop'>.</span> <span class='hs-varid'>forkProcess</span> <span class='hs-varop'>.</span> <span class='hs-varid'>finally</span> <span class='hs-varid'>nullStdin</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-404"></a>                <span class='hs-varid'>uninstallSignalHandlers</span>
<a name="line-405"></a>                <span class='hs-varid'>createSession</span>
<a name="line-406"></a>                <span class='hs-varid'>x</span>
<a name="line-407"></a> <span class='hs-keyword'>where</span>
<a name="line-408"></a>    <span class='hs-varid'>nullStdin</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-409"></a>        <span class='hs-varid'>fd</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>openFd</span> <span class='hs-str'>"/dev/null"</span> <span class='hs-conid'>ReadOnly</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>defaultFileFlags</span>
<a name="line-410"></a>        <span class='hs-varid'>dupTo</span> <span class='hs-varid'>fd</span> <span class='hs-varid'>stdInput</span>
<a name="line-411"></a>        <span class='hs-varid'>closeFd</span> <span class='hs-varid'>fd</span>
<a name="line-412"></a>
<a name="line-413"></a><a name="runOnWorkspaces"></a><span class='hs-comment'>-- | This is basically a map function, running a function in the 'X' monad on</span>
<a name="line-414"></a><span class='hs-comment'>-- each workspace with the output of that function being the modified workspace.</span>
<a name="line-415"></a><span class='hs-definition'>runOnWorkspaces</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>WindowSpace</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>WindowSpace</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-416"></a><span class='hs-definition'>runOnWorkspaces</span> <span class='hs-varid'>job</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-417"></a>    <span class='hs-varid'>ws</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>gets</span> <span class='hs-varid'>windowset</span>
<a name="line-418"></a>    <span class='hs-varid'>h</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>job</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hidden</span> <span class='hs-varid'>ws</span>
<a name="line-419"></a>    <span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-varid'>v</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-layout'>{</span> <span class='hs-varid'>workspace</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>w</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>job</span> <span class='hs-layout'>(</span><span class='hs-varid'>workspace</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-420"></a>             <span class='hs-varop'>$</span> <span class='hs-varid'>current</span> <span class='hs-varid'>ws</span> <span class='hs-conop'>:</span> <span class='hs-varid'>visible</span> <span class='hs-varid'>ws</span>
<a name="line-421"></a>    <span class='hs-varid'>modify</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-layout'>{</span> <span class='hs-varid'>windowset</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ws</span> <span class='hs-layout'>{</span> <span class='hs-varid'>current</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>visible</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>hidden</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>h</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span>
<a name="line-422"></a>
<a name="line-423"></a><a name="getXMonadDir"></a><span class='hs-comment'>-- | Return the path to @~\/.xmonad@.</span>
<a name="line-424"></a><span class='hs-definition'>getXMonadDir</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>String</span>
<a name="line-425"></a><span class='hs-definition'>getXMonadDir</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>io</span> <span class='hs-varop'>$</span> <span class='hs-varid'>getAppUserDataDirectory</span> <span class='hs-str'>"xmonad"</span>
<a name="line-426"></a>
<a name="line-427"></a><a name="recompile"></a><span class='hs-comment'>-- | 'recompile force', recompile @~\/.xmonad\/xmonad.hs@ when any of the</span>
<a name="line-428"></a><span class='hs-comment'>-- following apply:</span>
<a name="line-429"></a><span class='hs-comment'>--</span>
<a name="line-430"></a><span class='hs-comment'>--      * force is 'True'</span>
<a name="line-431"></a><span class='hs-comment'>--</span>
<a name="line-432"></a><span class='hs-comment'>--      * the xmonad executable does not exist</span>
<a name="line-433"></a><span class='hs-comment'>--</span>
<a name="line-434"></a><span class='hs-comment'>--      * the xmonad executable is older than xmonad.hs or any file in</span>
<a name="line-435"></a><span class='hs-comment'>--        ~\/.xmonad\/lib</span>
<a name="line-436"></a><span class='hs-comment'>--</span>
<a name="line-437"></a><span class='hs-comment'>-- The -i flag is used to restrict recompilation to the xmonad.hs file only,</span>
<a name="line-438"></a><span class='hs-comment'>-- and any files in the ~\/.xmonad\/lib directory.</span>
<a name="line-439"></a><span class='hs-comment'>--</span>
<a name="line-440"></a><span class='hs-comment'>-- Compilation errors (if any) are logged to ~\/.xmonad\/xmonad.errors.  If</span>
<a name="line-441"></a><span class='hs-comment'>-- GHC indicates failure with a non-zero exit code, an xmessage displaying</span>
<a name="line-442"></a><span class='hs-comment'>-- that file is spawned.</span>
<a name="line-443"></a><span class='hs-comment'>--</span>
<a name="line-444"></a><span class='hs-comment'>-- 'False' is returned if there are compilation errors.</span>
<a name="line-445"></a><span class='hs-comment'>--</span>
<a name="line-446"></a><span class='hs-definition'>recompile</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>Bool</span>
<a name="line-447"></a><span class='hs-definition'>recompile</span> <span class='hs-varid'>force</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>io</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-448"></a>    <span class='hs-varid'>dir</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getXMonadDir</span>
<a name="line-449"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>binn</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"xmonad-"</span><span class='hs-varop'>++</span><span class='hs-varid'>arch</span><span class='hs-varop'>++</span><span class='hs-str'>"-"</span><span class='hs-varop'>++</span><span class='hs-varid'>os</span>
<a name="line-450"></a>        <span class='hs-varid'>bin</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dir</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-varid'>binn</span>
<a name="line-451"></a>        <span class='hs-varid'>base</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dir</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"xmonad"</span>
<a name="line-452"></a>        <span class='hs-varid'>err</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>base</span> <span class='hs-varop'>++</span> <span class='hs-str'>".errors"</span>
<a name="line-453"></a>        <span class='hs-varid'>src</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>base</span> <span class='hs-varop'>++</span> <span class='hs-str'>".hs"</span>
<a name="line-454"></a>        <span class='hs-varid'>lib</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dir</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"lib"</span>
<a name="line-455"></a>    <span class='hs-varid'>libTs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>getModTime</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Prelude</span><span class='hs-varop'>.</span><span class='hs-varid'>filter</span> <span class='hs-varid'>isSource</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>allFiles</span> <span class='hs-varid'>lib</span>
<a name="line-456"></a>    <span class='hs-varid'>srcT</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getModTime</span> <span class='hs-varid'>src</span>
<a name="line-457"></a>    <span class='hs-varid'>binT</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getModTime</span> <span class='hs-varid'>bin</span>
<a name="line-458"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>force</span> <span class='hs-varop'>||</span> <span class='hs-varid'>any</span> <span class='hs-layout'>(</span><span class='hs-varid'>binT</span> <span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>srcT</span> <span class='hs-conop'>:</span> <span class='hs-varid'>libTs</span><span class='hs-layout'>)</span>
<a name="line-459"></a>      <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<a name="line-460"></a>        <span class='hs-comment'>-- temporarily disable SIGCHLD ignoring:</span>
<a name="line-461"></a>        <span class='hs-varid'>uninstallSignalHandlers</span>
<a name="line-462"></a>        <span class='hs-varid'>status</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>bracket</span> <span class='hs-layout'>(</span><span class='hs-varid'>openFile</span> <span class='hs-varid'>err</span> <span class='hs-conid'>WriteMode</span><span class='hs-layout'>)</span> <span class='hs-varid'>hClose</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>h</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-463"></a>            <span class='hs-varid'>waitForProcess</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>runProcess</span> <span class='hs-str'>"ghc"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"--make"</span><span class='hs-layout'>,</span> <span class='hs-str'>"xmonad.hs"</span><span class='hs-layout'>,</span> <span class='hs-str'>"-i"</span><span class='hs-layout'>,</span> <span class='hs-str'>"-ilib"</span><span class='hs-layout'>,</span> <span class='hs-str'>"-fforce-recomp"</span><span class='hs-layout'>,</span> <span class='hs-str'>"-v0"</span><span class='hs-layout'>,</span> <span class='hs-str'>"-o"</span><span class='hs-layout'>,</span><span class='hs-varid'>binn</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>dir</span><span class='hs-layout'>)</span>
<a name="line-464"></a>                                    <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span>
<a name="line-465"></a>
<a name="line-466"></a>        <span class='hs-comment'>-- re-enable SIGCHLD:</span>
<a name="line-467"></a>        <span class='hs-varid'>installSignalHandlers</span>
<a name="line-468"></a>
<a name="line-469"></a>        <span class='hs-comment'>-- now, if it fails, run xmessage to let the user know:</span>
<a name="line-470"></a>        <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>status</span> <span class='hs-varop'>/=</span> <span class='hs-conid'>ExitSuccess</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-471"></a>            <span class='hs-varid'>ghcErr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readFile</span> <span class='hs-varid'>err</span>
<a name="line-472"></a>            <span class='hs-keyword'>let</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unlines</span> <span class='hs-varop'>$</span>
<a name="line-473"></a>                    <span class='hs-keyglyph'>[</span><span class='hs-str'>"Error detected while loading xmonad configuration file: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>src</span><span class='hs-keyglyph'>]</span>
<a name="line-474"></a>                    <span class='hs-varop'>++</span> <span class='hs-varid'>lines</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>ghcErr</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>show</span> <span class='hs-varid'>status</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>ghcErr</span><span class='hs-layout'>)</span>
<a name="line-475"></a>                    <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>""</span><span class='hs-layout'>,</span><span class='hs-str'>"Please check the file for errors."</span><span class='hs-keyglyph'>]</span>
<a name="line-476"></a>            <span class='hs-comment'>-- nb, the ordering of printing, then forking, is crucial due to</span>
<a name="line-477"></a>            <span class='hs-comment'>-- lazy evaluation</span>
<a name="line-478"></a>            <span class='hs-varid'>hPutStrLn</span> <span class='hs-varid'>stderr</span> <span class='hs-varid'>msg</span>
<a name="line-479"></a>            <span class='hs-varid'>forkProcess</span> <span class='hs-varop'>$</span> <span class='hs-varid'>executeFile</span> <span class='hs-str'>"xmessage"</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"-default"</span><span class='hs-layout'>,</span> <span class='hs-str'>"okay"</span><span class='hs-layout'>,</span> <span class='hs-varid'>msg</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>Nothing</span>
<a name="line-480"></a>            <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-481"></a>        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>status</span> <span class='hs-varop'>==</span> <span class='hs-conid'>ExitSuccess</span><span class='hs-layout'>)</span>
<a name="line-482"></a>      <span class='hs-keyword'>else</span> <span class='hs-varid'>return</span> <span class='hs-conid'>True</span>
<a name="line-483"></a> <span class='hs-keyword'>where</span> <span class='hs-varid'>getModTime</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>catch</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>getModificationTime</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-484"></a>       <span class='hs-varid'>isSource</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>elem</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>".hs"</span><span class='hs-layout'>,</span><span class='hs-str'>".lhs"</span><span class='hs-layout'>,</span><span class='hs-str'>".hsc"</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>.</span> <span class='hs-varid'>takeExtension</span>
<a name="line-485"></a>       <span class='hs-varid'>allFiles</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-486"></a>            <span class='hs-keyword'>let</span> <span class='hs-varid'>prep</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span><span class='hs-varop'>&lt;/&gt;</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Prelude</span><span class='hs-varop'>.</span><span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varop'>`notElem`</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"."</span><span class='hs-layout'>,</span><span class='hs-str'>".."</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-487"></a>            <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>prep</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>catch</span> <span class='hs-layout'>(</span><span class='hs-varid'>getDirectoryContents</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-488"></a>            <span class='hs-varid'>ds</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>filterM</span> <span class='hs-varid'>doesDirectoryExist</span> <span class='hs-varid'>cs</span>
<a name="line-489"></a>            <span class='hs-varid'>concat</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>cs</span> <span class='hs-varop'>\\</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>allFiles</span> <span class='hs-varid'>ds</span>
<a name="line-490"></a>
<a name="line-491"></a><a name="whenJust"></a><span class='hs-comment'>-- | Conditionally run an action, using a @Maybe a@ to decide.</span>
<a name="line-492"></a><span class='hs-definition'>whenJust</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-493"></a><span class='hs-definition'>whenJust</span> <span class='hs-varid'>mg</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>mg</span>
<a name="line-494"></a>
<a name="line-495"></a><a name="whenX"></a><span class='hs-comment'>-- | Conditionally run an action, using a 'X' event to decide</span>
<a name="line-496"></a><span class='hs-definition'>whenX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>X</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span>
<a name="line-497"></a><span class='hs-definition'>whenX</span> <span class='hs-varid'>a</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>when</span> <span class='hs-varid'>b</span> <span class='hs-varid'>f</span>
<a name="line-498"></a>
<a name="line-499"></a><a name="trace"></a><span class='hs-comment'>-- | A 'trace' for the 'X' monad. Logs a string to stderr. The result may</span>
<a name="line-500"></a><span class='hs-comment'>-- be found in your .xsession-errors file</span>
<a name="line-501"></a><span class='hs-definition'>trace</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-502"></a><span class='hs-definition'>trace</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>io</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hPutStrLn</span> <span class='hs-varid'>stderr</span>
<a name="line-503"></a>
<a name="line-504"></a><a name="installSignalHandlers"></a><span class='hs-comment'>-- | Ignore SIGPIPE to avoid termination when a pipe is full, and SIGCHLD to</span>
<a name="line-505"></a><span class='hs-comment'>-- avoid zombie processes, and clean up any extant zombie processes.</span>
<a name="line-506"></a><span class='hs-definition'>installSignalHandlers</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-507"></a><span class='hs-definition'>installSignalHandlers</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>io</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-508"></a>    <span class='hs-varid'>installHandler</span> <span class='hs-varid'>openEndedPipe</span> <span class='hs-conid'>Ignore</span> <span class='hs-conid'>Nothing</span>
<a name="line-509"></a>    <span class='hs-varid'>installHandler</span> <span class='hs-varid'>sigCHLD</span> <span class='hs-conid'>Ignore</span> <span class='hs-conid'>Nothing</span>
<a name="line-510"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>SomeException</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-511"></a>      <span class='hs-varop'>$</span> <span class='hs-varid'>fix</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>more</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-512"></a>        <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getAnyProcessStatus</span> <span class='hs-conid'>False</span> <span class='hs-conid'>False</span>
<a name="line-513"></a>        <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>isJust</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>more</span>
<a name="line-514"></a>    <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-515"></a>
<a name="line-516"></a><a name="uninstallSignalHandlers"></a><span class='hs-definition'>uninstallSignalHandlers</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-517"></a><span class='hs-definition'>uninstallSignalHandlers</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>io</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-518"></a>    <span class='hs-varid'>installHandler</span> <span class='hs-varid'>openEndedPipe</span> <span class='hs-conid'>Default</span> <span class='hs-conid'>Nothing</span>
<a name="line-519"></a>    <span class='hs-varid'>installHandler</span> <span class='hs-varid'>sigCHLD</span> <span class='hs-conid'>Default</span> <span class='hs-conid'>Nothing</span>
<a name="line-520"></a>    <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
</pre></body>
</html>
